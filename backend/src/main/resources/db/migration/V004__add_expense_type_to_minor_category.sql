-- ================================================================
-- 支出管理模块 - 子分类添加支出类型
-- 版本: v1.2
-- 日期: 2025-12-10
-- 说明: 支出类型归属于子分类，不是每次录入都选择
-- ================================================================

-- ----------------------------------------------------------------
-- 1. 给子分类表添加expense_type字段
-- ----------------------------------------------------------------
ALTER TABLE expense_categories_minor
  ADD COLUMN expense_type VARCHAR(20) NOT NULL DEFAULT 'FIXED_DAILY'
    COMMENT '默认支出类型（FIXED_DAILY/LARGE_IRREGULAR）'
    AFTER description;

-- ----------------------------------------------------------------
-- 2. 更新已有数据（根据分类名称智能设置类型）
-- ----------------------------------------------------------------
-- 大额不定期分类关键词：旅游、装修、家电、车、大病、婚丧、礼金等
UPDATE expense_categories_minor
SET expense_type = 'LARGE_IRREGULAR'
WHERE name REGEXP '旅游|装修|家电|买车|车贷|大病|手术|婚|丧|礼金|家具';

-- 其他保持FIXED_DAILY（默认值）

-- ================================================================
-- 说明：
-- 1. expense_type是子分类的固定属性，不需要每次录入都选择
-- 2. 例如："房租"永远是FIXED_DAILY，"旅游"永远是LARGE_IRREGULAR
-- 3. 创建/编辑子分类时设置，录入支出时自动使用该分类的类型
-- ================================================================
