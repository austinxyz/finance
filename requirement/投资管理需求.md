# æŠ•èµ„ç®¡ç†éœ€æ±‚æ–‡æ¡£

## 1. åŠŸèƒ½æ¦‚è¿°

### 1.1 ç›®æ ‡
ä¸ºä¸ªäººç†è´¢ç³»ç»Ÿæ·»åŠ æŠ•èµ„ç®¡ç†æ¨¡å—ï¼Œæ”¯æŒæŠ•èµ„è´¦æˆ·çš„äº¤æ˜“è®°å½•ã€æŠ•èµ„åˆ†æå’Œå›æŠ¥ç‡è®¡ç®—ã€‚

### 1.2 æ ¸å¿ƒåŠŸèƒ½
- æ ‡è¯†æŠ•èµ„ç±»èµ„äº§è´¦æˆ·
- è®°å½•æŠ•èµ„äº¤æ˜“ï¼ˆæŠ•å…¥/å–å‡ºï¼‰
- æ‰¹é‡å½•å…¥æŠ•èµ„äº¤æ˜“
- æŠ•èµ„å¹´åº¦åˆ†æå’Œå›æŠ¥ç‡è®¡ç®—
- æŠ•èµ„æ•°æ®å¯è§†åŒ–

## 2. æ•°æ®æ¨¡å‹è®¾è®¡

### 2.1 èµ„äº§åˆ†ç±»è¡¨ä¿®æ”¹ (asset_categories)

**æ–°å¢å­—æ®µ**:
```sql
is_investment BOOLEAN DEFAULT FALSE COMMENT 'æ˜¯å¦ä¸ºæŠ•èµ„ç±»è´¦æˆ·'
```

**æŠ•èµ„ç±»èµ„äº§å¤§ç±»**:
- è‚¡ç¥¨æŠ•èµ„ (STOCKS) - is_investment = TRUE
- é€€ä¼‘åŸºé‡‘ (RETIREMENT_FUND) - is_investment = TRUE
- æ•°å­—è´§å¸ (CRYPTOCURRENCY) - is_investment = TRUE
- å…¶ä»–å¯èƒ½éœ€è¦æ ‡è®°çš„ç±»åˆ«

**éæŠ•èµ„ç±»èµ„äº§**:
- ç°é‡‘ (CASH) - is_investment = FALSE
- ä¿é™© (INSURANCE) - is_investment = FALSE
- æˆ¿äº§ (REAL_ESTATE) - is_investment = FALSE
- è´µé‡‘å± (PRECIOUS_METALS) - å¯é€‰

### 2.2 æŠ•èµ„äº¤æ˜“è®°å½•è¡¨ (investment_transactions)

**è¡¨ç»“æ„**:
```sql
CREATE TABLE investment_transactions (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    account_id BIGINT NOT NULL COMMENT 'èµ„äº§è´¦æˆ·ID',
    transaction_period VARCHAR(7) NOT NULL COMMENT 'äº¤æ˜“æœŸé—´(YYYY-MMæ ¼å¼)',
    transaction_type ENUM('DEPOSIT', 'WITHDRAWAL') NOT NULL COMMENT 'äº¤æ˜“ç±»å‹ï¼šæŠ•å…¥/å–å‡º',
    amount DECIMAL(15,2) NOT NULL COMMENT 'äº¤æ˜“é‡‘é¢',
    description VARCHAR(500) COMMENT 'äº¤æ˜“è¯´æ˜',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    FOREIGN KEY (account_id) REFERENCES asset_accounts(id) ON DELETE CASCADE,

    INDEX idx_account_period (account_id, transaction_period)
) COMMENT='æŠ•èµ„äº¤æ˜“è®°å½•è¡¨';
```

**å­—æ®µè¯´æ˜**:
- `transaction_period`: æ ¼å¼ä¸º "YYYY-MM"ï¼Œä¾‹å¦‚ "2024-01"
- `transaction_type`:
  - `DEPOSIT`: æŠ•å…¥ï¼ˆä¹°å…¥ã€è¿½åŠ æŠ•èµ„ï¼‰
  - `WITHDRAWAL`: å–å‡ºï¼ˆå–å‡ºã€æå–èµ„é‡‘ï¼‰
- `amount`: æ­£æ•°è¡¨ç¤ºé‡‘é¢ï¼Œç±»å‹ç”±transaction_typeå†³å®šæ–¹å‘

**è¡ç”Ÿå­—æ®µï¼ˆé€šè¿‡å…³è”æŸ¥è¯¢è·å–ï¼‰**:
- `user_id`: é€šè¿‡ account_id â†’ asset_accounts â†’ user_id è·å–
- `family_id`: é€šè¿‡ account_id â†’ asset_accounts â†’ user_id â†’ family_members â†’ family_id è·å–
- `currency`: é€šè¿‡ account_id â†’ asset_accounts â†’ currency è·å–

### 2.3 ä¸ç°æœ‰è¡¨çš„å…³ç³»

```
asset_categories (èµ„äº§åˆ†ç±»)
    â†“ is_investment = TRUE
asset_accounts (èµ„äº§è´¦æˆ·)
    â†“
investment_transactions (æŠ•èµ„äº¤æ˜“)
    â†“ ç”¨äºåˆ†æ
asset_records (èµ„äº§è®°å½• - ç”¨äºè·å–æœŸåˆæœŸæœ«å€¼)
```

## 3. åŠŸèƒ½æ¨¡å—è¯¦ç»†è¯´æ˜

### 3.1 ç®¡ç†-æŠ•èµ„ç®¡ç†-åˆ†ç±»ä¸è®°å½•

**é¡µé¢è·¯å¾„**: `/management/investment/records`

**é¡µé¢å¸ƒå±€**: å®Œå…¨å‚ç…§"æ”¯å‡ºç®¡ç†-åˆ†ç±»ä¸è®°å½•"ï¼ˆExpenseCategories.vueï¼‰çš„å¸ƒå±€è®¾è®¡

#### é¡µé¢ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æŠ•èµ„ç®¡ç† - åˆ†ç±»ä¸è®°å½•              [é€‰æ‹©å®¶åº­: Family 1 â–¼]  â”‚
â”‚  ç®¡ç†æŠ•èµ„è´¦æˆ·ï¼ŒæŒ‰å¤§ç±»æŸ¥çœ‹æŠ•èµ„è¶‹åŠ¿å’Œäº¤æ˜“è®°å½•                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“ˆ è‚¡ç¥¨æŠ•èµ„  â”‚  ğŸ¦ é€€ä¼‘åŸºé‡‘  â”‚  ğŸ’ æ•°å­—è´§å¸                â”‚  â† å¤§ç±»Tabï¼ˆæ¨ªå‘ï¼‰
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æŠ•èµ„è´¦æˆ·â”‚                                                   â”‚
â”‚ åˆ—è¡¨    â”‚  è´¦æˆ·ä¿¡æ¯å¡ç‰‡                                      â”‚
â”‚ (3åˆ—)  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚         â”‚  â”‚ ğŸ“ˆ è‚¡ç¥¨æŠ•èµ„ - Fidelity 401k                 â”‚ â”‚
â”‚ Fidelityâ”‚  â”‚ æŒæœ‰äºº: å¼ ä¸‰ | å¸ç§: USD                    â”‚ â”‚
â”‚ 401k    â”‚  â”‚ å½“å‰æ€»å€¼: $152,500 (2024-01-31)      [+ æ·»åŠ â”‚ â”‚
â”‚ $152.5K â”‚  â”‚                                      äº¤æ˜“]  â”‚ â”‚
â”‚ 12æ¡è®°å½•â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ [âœï¸]    â”‚                                                   â”‚
â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ Charles â”‚  â”‚  æŠ•èµ„è¶‹åŠ¿        â”‚  â”‚  äº¤æ˜“å†å²            â”‚ â”‚
â”‚ Schwab  â”‚  â”‚  [6æœˆ][1å¹´][3å¹´] â”‚  â”‚                      â”‚ â”‚
â”‚ $85.2K  â”‚  â”‚  [å…¨éƒ¨]          â”‚  â”‚  æœŸé—´  â”‚ç±»å‹â”‚é‡‘é¢â”‚æ“ä½œâ”‚ â”‚
â”‚ 8æ¡è®°å½• â”‚  â”‚                  â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”‚ â”‚
â”‚ [âœï¸]    â”‚  â”‚  [æŠ˜çº¿å›¾         â”‚  â”‚ 2024-01â”‚æŠ•å…¥â”‚$2.5Kâ”‚âœï¸ğŸ—‘ï¸â”‚ â”‚
â”‚         â”‚  â”‚   +æŸ±çŠ¶å›¾]       â”‚  â”‚ 2024-02â”‚æŠ•å…¥â”‚$2.5Kâ”‚âœï¸ğŸ—‘ï¸â”‚ â”‚
â”‚ Robinhoodâ”‚  â”‚                  â”‚  â”‚ 2024-03â”‚å–å‡ºâ”‚$1.0Kâ”‚âœï¸ğŸ—‘ï¸â”‚ â”‚
â”‚ $12.8K  â”‚  â”‚                  â”‚  â”‚                      â”‚ â”‚
â”‚ 3æ¡è®°å½• â”‚  â”‚                  â”‚  â”‚                      â”‚ â”‚
â”‚ [âœï¸]    â”‚  â”‚                  â”‚  â”‚                      â”‚ â”‚
â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€ â”‚                      (ä¸¤åˆ—ç­‰å®½å¸ƒå±€)             â”‚
â”‚ è‚¡ç¥¨æŠ•èµ„â”‚                                                   â”‚
â”‚ æ€»è®¡    â”‚                                                   â”‚
â”‚ $250.5K â”‚                                                   â”‚
â”‚ å…±3ä¸ªè´¦æˆ·â”‚                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 1. é¡¶éƒ¨åŒºåŸŸï¼ˆé¡µé¢æ ‡é¢˜å’Œæ§åˆ¶ï¼‰
```html
<div class="flex items-center justify-between">
  <div>
    <h1>æŠ•èµ„ç®¡ç† - åˆ†ç±»ä¸è®°å½•</h1>
    <p>ç®¡ç†æŠ•èµ„è´¦æˆ·ï¼ŒæŒ‰å¤§ç±»æŸ¥çœ‹æŠ•èµ„è¶‹åŠ¿å’Œäº¤æ˜“è®°å½•</p>
  </div>
  <div>
    <label>é€‰æ‹©å®¶åº­:</label>
    <select v-model="selectedFamilyId">...</select>
  </div>
</div>
```

#### 2. å¤§ç±»TabåŒºåŸŸï¼ˆæ°´å¹³Tabæ ï¼‰
```html
<nav class="flex space-x-4 border-b">
  <button
    v-for="category in investmentCategories"
    @click="selectedCategory = category"
    :class="é€‰ä¸­æ ·å¼"
  >
    <span>{{ category.icon }}</span>
    {{ category.name }}
  </button>
</nav>
```

**ç‰¹ç‚¹**:
- æ¨ªå‘æ»šåŠ¨Tabæ 
- åªæ˜¾ç¤ºæŠ•èµ„ç±»èµ„äº§å¤§ç±»ï¼ˆ`is_investment = TRUE`ï¼‰
- Tabæ ¼å¼ï¼š`å›¾æ ‡ + å¤§ç±»åç§°`
- é€‰ä¸­Tabåº•éƒ¨è“è‰²ä¸‹åˆ’çº¿

#### 3. ä¸‰åˆ—Gridå¸ƒå±€ (grid-cols-12)

**å·¦ä¾§æ ï¼ˆcol-span-3ï¼‰ï¼šæŠ•èµ„è´¦æˆ·åˆ—è¡¨**

```html
<div class="col-span-3 bg-white rounded-lg shadow">
  <!-- æ ‡é¢˜æ  -->
  <div class="px-4 py-3 border-b flex justify-between">
    <h2>æŠ•èµ„è´¦æˆ·åˆ—è¡¨</h2>
    <!-- æ— æ·»åŠ æŒ‰é’® -->
  </div>

  <!-- è´¦æˆ·åˆ—è¡¨ -->
  <div class="divide-y max-h-[calc(100vh-400px)] overflow-y-auto">
    <div
      v-for="account in accounts"
      @click="selectAccount(account)"
      :class="é€‰ä¸­é«˜äº®æ ·å¼"
      class="group relative"
    >
      <div class="px-3 py-2">
        <div class="font-medium">{{ account.accountName }}</div>
        <div class="text-xs text-gray-500">
          {{ account.recordCount }}æ¡è®°å½•
          <span v-if="account.latestValue">
            æœ€è¿‘${{ account.latestValue }}
          </span>
        </div>
      </div>
      <!-- æ‚¬åœæ˜¾ç¤ºç¼–è¾‘æŒ‰é’® -->
      <button class="absolute top-2 right-2 opacity-0 group-hover:opacity-100">
        âœï¸
      </button>
    </div>
  </div>

  <!-- åº•éƒ¨æ±‡æ€» -->
  <div class="px-4 py-3 border-t bg-gray-50">
    <div class="flex justify-between">
      <span>{{ selectedCategory.name }}æ€»è®¡</span>
      <span class="font-bold">${{ categoryTotal }}</span>
    </div>
    <div class="text-xs text-gray-500">
      å…± {{ accounts.length }} ä¸ªè´¦æˆ·
    </div>
  </div>
</div>
```

**å³ä¾§åŒºåŸŸï¼ˆcol-span-9ï¼‰ï¼šè´¦æˆ·è¯¦æƒ…**

**æœªé€‰ä¸­è´¦æˆ·æ—¶**:
```html
<div class="col-span-9 bg-white rounded-lg shadow p-12 text-center">
  <svg>...</svg>
  <h3>è¯·é€‰æ‹©æŠ•èµ„è´¦æˆ·</h3>
  <p>ä»å·¦ä¾§åˆ—è¡¨é€‰æ‹©ä¸€ä¸ªè´¦æˆ·æŸ¥çœ‹è¯¦æƒ…å’Œäº¤æ˜“è®°å½•</p>
</div>
```

**é€‰ä¸­è´¦æˆ·å**:

**è´¦æˆ·ä¿¡æ¯å¡ç‰‡**:
```html
<div class="bg-white rounded-lg shadow border p-4 mb-6">
  <div class="flex items-center justify-between">
    <div>
      <h2 class="flex items-center gap-2">
        <span>{{ category.icon }}</span>
        {{ category.name }} - {{ account.accountName }}
      </h2>
      <p>æŒæœ‰äºº: {{ account.holderName }} | å¸ç§: {{ account.currency }}</p>
    </div>
    <button class="btn-primary" @click="openTransactionDialog()">
      + æ·»åŠ äº¤æ˜“
    </button>
  </div>
</div>
```

**ä¸¤åˆ—å­å¸ƒå±€ï¼ˆgrid-cols-2ï¼Œç­‰å®½ï¼‰**:

**å·¦åˆ—ï¼šæŠ•èµ„è¶‹åŠ¿å›¾**:
```html
<div class="bg-white rounded-lg shadow border p-6">
  <div class="flex justify-between mb-4">
    <h3>æŠ•èµ„è¶‹åŠ¿</h3>
    <div class="flex gap-2">
      <button @click="timeRange='6m'">6æœˆ</button>
      <button @click="timeRange='12m'">1å¹´</button>
      <button @click="timeRange='36m'">3å¹´</button>
      <button @click="timeRange='all'">å…¨éƒ¨</button>
    </div>
  </div>
  <div v-if="hasData" class="h-80">
    <canvas ref="chartCanvas"></canvas>
  </div>
  <div v-else class="h-80 flex items-center justify-center">
    æš‚æ— æ•°æ®ï¼Œè¯·æ·»åŠ è®°å½•
  </div>
</div>
```

**å›¾è¡¨è¯´æ˜**:
- **æŠ˜çº¿å›¾**: è´¦æˆ·æ€»å€¼è¶‹åŠ¿ï¼ˆä»`asset_records`è·å–æœˆæœ«å€¼ï¼‰
- **æŸ±çŠ¶å›¾**: æŠ•å…¥/å–å‡ºäº¤æ˜“ï¼ˆä»`investment_transactions`è·å–ï¼‰
  - ç»¿è‰²æŸ±ï¼šæŠ•å…¥ï¼ˆDEPOSITï¼‰
  - çº¢è‰²æŸ±ï¼šå–å‡ºï¼ˆWITHDRAWALï¼‰
- ä½¿ç”¨Chart.jsçš„æ··åˆå›¾è¡¨ç±»å‹

**å³åˆ—ï¼šäº¤æ˜“å†å²è®°å½•**:
```html
<div class="bg-white rounded-lg shadow border">
  <div class="px-4 py-3 border-b">
    <h3>äº¤æ˜“å†å²</h3>
  </div>
  <div v-if="loading">åŠ è½½ä¸­...</div>
  <div v-else-if="transactions.length === 0">æš‚æ— è®°å½•</div>
  <div v-else class="max-h-[480px] overflow-y-auto">
    <table class="w-full">
      <thead class="bg-gray-50 sticky top-0">
        <tr>
          <th>æœŸé—´</th>
          <th>ç±»å‹</th>
          <th class="text-right">é‡‘é¢</th>
          <th class="text-right">æ“ä½œ</th>
        </tr>
      </thead>
      <tbody>
        <tr v-for="tx in transactions">
          <td>{{ tx.transactionPeriod }}</td>
          <td>{{ tx.transactionType === 'DEPOSIT' ? 'æŠ•å…¥' : 'å–å‡º' }}</td>
          <td class="text-right">
            {{ getCurrencySymbol(account.currency) }}{{ formatNumber(tx.amount) }}
          </td>
          <td class="text-right">
            <button @click="editTransaction(tx)">ç¼–è¾‘</button>
            <button @click="deleteTransaction(tx)">åˆ é™¤</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
```

#### 4. æ–°å¢/ç¼–è¾‘äº¤æ˜“å¼¹çª—

```html
<div v-if="showDialog" class="fixed inset-0 bg-black/50 flex items-center justify-center">
  <div class="bg-white rounded-lg shadow-xl w-full max-w-md">
    <div class="px-6 py-4 border-b">
      <h3>{{ isEditing ? 'ç¼–è¾‘äº¤æ˜“' : 'æ·»åŠ æŠ•èµ„äº¤æ˜“' }}</h3>
    </div>
    <div class="px-6 py-4 space-y-4">
      <!-- è´¦æˆ·ï¼ˆåªè¯»ï¼‰ -->
      <div>
        <label>è´¦æˆ· *</label>
        <input :value="selectedAccount.accountName" readonly class="bg-gray-100" />
      </div>

      <!-- å¸ç§ï¼ˆåªè¯»ï¼‰ -->
      <div>
        <label>å¸ç§ *</label>
        <input :value="selectedAccount.currency" readonly class="bg-gray-100" />
      </div>

      <!-- äº¤æ˜“æœŸé—´ -->
      <div>
        <label>äº¤æ˜“æœŸé—´ *</label>
        <input v-model="form.transactionPeriod" type="month" />
      </div>

      <!-- äº¤æ˜“ç±»å‹ -->
      <div>
        <label>äº¤æ˜“ç±»å‹ *</label>
        <div class="flex gap-4">
          <label class="flex items-center gap-2">
            <input v-model="form.transactionType" type="radio" value="DEPOSIT" />
            <div>
              <span>æŠ•å…¥</span>
              <span class="text-xs text-gray-500">(ä¹°å…¥ã€è¿½åŠ æŠ•èµ„)</span>
            </div>
          </label>
          <label class="flex items-center gap-2">
            <input v-model="form.transactionType" type="radio" value="WITHDRAWAL" />
            <div>
              <span>å–å‡º</span>
              <span class="text-xs text-gray-500">(å–å‡ºã€æå–èµ„é‡‘)</span>
            </div>
          </label>
        </div>
      </div>

      <!-- é‡‘é¢ -->
      <div>
        <label>é‡‘é¢ *</label>
        <div class="relative">
          <span class="absolute left-3 top-2">{{ getCurrencySymbol(selectedAccount.currency) }}</span>
          <input v-model="form.amount" type="number" step="0.01" class="pl-8" />
        </div>
      </div>

      <!-- è¯´æ˜ -->
      <div>
        <label>è¯´æ˜</label>
        <textarea v-model="form.description" rows="2" maxlength="200"></textarea>
      </div>
    </div>
    <div class="px-6 py-4 border-t flex justify-end gap-3">
      <button @click="closeDialog()">å–æ¶ˆ</button>
      <button @click="saveTransaction()" class="btn-primary">ä¿å­˜</button>
    </div>
  </div>
</div>
```

#### 5. äº¤äº’æµç¨‹

1. **åˆå§‹åŠ è½½**:
   - åŠ è½½æ‰€æœ‰æŠ•èµ„å¤§ç±»ï¼ˆ`is_investment = TRUE`ï¼‰
   - é»˜è®¤é€‰ä¸­ç¬¬ä¸€ä¸ªå¤§ç±»Tab
   - åŠ è½½è¯¥å¤§ç±»ä¸‹çš„æ‰€æœ‰è´¦æˆ·
   - å¦‚æœæœ‰è´¦æˆ·ï¼Œé»˜è®¤é€‰ä¸­ç¬¬ä¸€ä¸ª

2. **åˆ‡æ¢å¤§ç±»Tab**:
   - æ¸…ç©ºå½“å‰é€‰ä¸­è´¦æˆ·
   - åŠ è½½æ–°ï¿½ï¿½ï¿½ç±»ä¸‹çš„è´¦æˆ·åˆ—è¡¨
   - æ¸…ç©ºå³ä¾§è¯¦æƒ…åŒºåŸŸ

3. **é€‰æ‹©è´¦æˆ·**:
   - é«˜äº®é€‰ä¸­è´¦æˆ·
   - åŠ è½½è´¦æˆ·åŸºæœ¬ä¿¡æ¯
   - åŠ è½½æœ€è¿‘12ä¸ªæœˆçš„èµ„äº§è®°å½•ï¼ˆç”¨äºæŠ˜çº¿å›¾ï¼‰
   - åŠ è½½æœ€è¿‘12ä¸ªæœˆçš„æŠ•èµ„äº¤æ˜“è®°å½•ï¼ˆç”¨äºæŸ±çŠ¶å›¾å’Œåˆ—è¡¨ï¼‰
   - æ¸²æŸ“è¶‹åŠ¿å›¾è¡¨

4. **åˆ‡æ¢æ—¶é—´èŒƒå›´**:
   - é‡æ–°åŠ è½½å¯¹åº”æ—¶é—´èŒƒå›´çš„æ•°æ®
   - æ›´æ–°å›¾è¡¨æ˜¾ç¤º

5. **æ·»åŠ /ç¼–è¾‘äº¤æ˜“**:
   - ç‚¹å‡»"+ æ·»åŠ äº¤æ˜“"æˆ–"ç¼–è¾‘"æŒ‰é’®
   - å¼¹å‡ºè¡¨å•å¯¹è¯æ¡†
   - å¡«å†™/ä¿®æ”¹äº¤æ˜“ä¿¡æ¯
   - ä¿å­˜ååˆ·æ–°äº¤æ˜“åˆ—è¡¨å’Œå›¾è¡¨

#### 6. æ•°æ®åŠ è½½é€»è¾‘

**APIè°ƒç”¨é¡ºåº**:
```javascript
// 1. åˆå§‹åŠ è½½
await loadInvestmentCategories()  // è·å–æŠ•èµ„å¤§ç±»
await loadAccountsByCategory(categoryId)  // è·å–è¯¥å¤§ç±»ä¸‹çš„è´¦æˆ·

// 2. é€‰ä¸­è´¦æˆ·
await loadAccountDetails(accountId)  // è·å–è´¦æˆ·è¯¦æƒ…
await loadAssetRecords(accountId, timeRange)  // è·å–èµ„äº§è®°å½•ï¼ˆæŠ˜çº¿å›¾ï¼‰
await loadTransactions(accountId, timeRange)  // è·å–äº¤æ˜“è®°å½•ï¼ˆæŸ±çŠ¶å›¾+åˆ—è¡¨ï¼‰

// 3. æ¸²æŸ“å›¾è¡¨
updateChart(assetRecords, transactions)
```

#### 7. å…³é”®å·®å¼‚è¯´æ˜

**ä¸æ”¯å‡ºç®¡ç†çš„åŒºåˆ«**:
| é¡¹ç›® | æ”¯å‡ºç®¡ç† | æŠ•èµ„ç®¡ç† |
|------|---------|---------|
| å·¦ä¾§åˆ—è¡¨ | å­åˆ†ç±»åˆ—è¡¨ | æŠ•èµ„è´¦æˆ·åˆ—è¡¨ |
| æ·»åŠ æŒ‰é’® | æ·»åŠ å­åˆ†ç±» | æ— ï¼ˆè´¦æˆ·åœ¨èµ„äº§ç®¡ç†æ·»åŠ ï¼‰ |
| ç¼–è¾‘åŠŸèƒ½ | ç¼–è¾‘å­åˆ†ç±» | ç¼–è¾‘æŒ‰é’®è·³è½¬åˆ°èµ„äº§ç®¡ç† |
| è®°å½•ç±»å‹ | å•ä¸€æ”¯å‡º | æŠ•å…¥/å–å‡ºä¸¤ç§ç±»å‹ |
| å›¾è¡¨æ•°æ® | ä»…æ”¯å‡ºé‡‘é¢ | è´¦æˆ·æ€»å€¼ + æŠ•å…¥/å–å‡º |
| æ•°æ®æ¥æº | expense_records | asset_records + investment_transactions |

### 3.2 ç®¡ç†-æŠ•èµ„ç®¡ç†-æ‰¹é‡å½•å…¥

**é¡µé¢è·¯å¾„**: `/management/investment/batch-entry`

**é¡µé¢å¸ƒå±€**: å®Œå…¨å‚ç…§"æ”¯å‡ºç®¡ç†-æ‰¹é‡å½•å…¥"ï¼ˆExpenseBatchUpdate.vueï¼‰çš„å¸ƒå±€è®¾è®¡

#### é¡µé¢ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ‰¹é‡å½•å…¥æŠ•èµ„äº¤æ˜“                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [å®¶åº­: Family 1 â–¼]  [æœˆä»½: 2024-01]        [ä¿å­˜å…¨éƒ¨]      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è´¦æˆ·               â”‚ 11æœˆ  â”‚ 12æœˆ  â”‚ 01æœˆ  â”‚ 2024å¹´02æœˆ    â”‚
â”‚                     â”‚(æŠ•å…¥) â”‚(æŠ•å…¥) â”‚(æŠ•å…¥) â”‚ æŠ•å…¥  â”‚ å–å‡º  â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ ğŸ“ˆ è‚¡ç¥¨æŠ•èµ„         â”‚       â”‚       â”‚       â”‚       â”‚       â”‚
â”‚   Fidelity 401k     â”‚ $2.5K â”‚ $2.5K â”‚ $2.5K â”‚[$2500]â”‚[$0  ] â”‚
â”‚   Charles Schwab    â”‚ $1.0K â”‚ $1.0K â”‚ $1.0K â”‚[$1000]â”‚[$0  ] â”‚
â”‚ ğŸ¦ é€€ä¼‘åŸºé‡‘         â”‚       â”‚       â”‚       â”‚       â”‚       â”‚
â”‚   Vanguard IRA      â”‚ $1.5K â”‚ $1.5K â”‚ $1.5K â”‚[$1500]â”‚[$0  ] â”‚
â”‚   Traditional IRA   â”‚   $0  â”‚   $0  â”‚   $0  â”‚[$ 0 ]â”‚[$0  ] â”‚
â”‚ ğŸ’ æ•°å­—è´§å¸         â”‚       â”‚       â”‚       â”‚       â”‚       â”‚
â”‚   Coinbase          â”‚   $0  â”‚   $0  â”‚ $500  â”‚[$ 0 ]â”‚[$500] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æœ¬æœˆæ€»æŠ•å…¥: $5,000      æœ¬æœˆæ€»å–å‡º: $500                    â”‚
â”‚  å‡€æŠ•å…¥: $4,500                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 1. é¡¶éƒ¨æ§åˆ¶åŒº

**æ§åˆ¶é¡¹**:
```html
<div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
  <!-- å®¶åº­é€‰æ‹©å™¨ -->
  <div class="flex items-center gap-2">
    <label>å®¶åº­ï¼š</label>
    <select v-model="selectedFamilyId">...</select>
  </div>

  <!-- æœˆä»½é€‰æ‹©å™¨ -->
  <div class="flex items-center gap-2">
    <label>æœˆä»½ï¼š</label>
    <input v-model="transactionPeriod" type="month" />
  </div>
</div>

<!-- ä¿å­˜æŒ‰é’® -->
<div class="flex justify-end">
  <button @click="saveAll" :disabled="!hasChanges">
    ä¿å­˜å…¨éƒ¨
  </button>
</div>
```

#### 2. æŠ•èµ„è´¦æˆ·åˆ—è¡¨è¡¨æ ¼

**è¡¨å¤´ç»“æ„**:
```
| è´¦æˆ· | å‰3æœˆï¼ˆæŠ•å…¥ï¼‰ | å‰2æœˆï¼ˆæŠ•å…¥ï¼‰ | ä¸Šæœˆï¼ˆæŠ•å…¥ï¼‰ | æœ¬æœˆæŠ•å…¥ | æœ¬æœˆå–å‡º |
```

**æ•°æ®åˆ—è¯´æ˜**:

1. **è´¦æˆ·åˆ—ï¼ˆcol-span-3ï¼‰**:
   - æ˜¾ç¤ºï¼šå¤§ç±»å›¾æ ‡ + å¤§ç±»åç§° + è´¦æˆ·åç§°
   - ç¤ºä¾‹ï¼š`ğŸ“ˆ è‚¡ç¥¨æŠ•èµ„ - Fidelity 401k`
   - æŒ‰å¤§ç±»åˆ†ç»„æ˜¾ç¤º

2. **å‰3ä¸ªæœˆåˆ—ï¼ˆå„å 2åˆ—ï¼Œåªè¯»ï¼Œæ˜¾ç¤ºæŠ•å…¥ï¼‰**:
   - æ˜¾ç¤ºæœ€è¿‘3ä¸ªæœˆçš„æŠ•å…¥é‡‘é¢ï¼ˆåªæ˜¾ç¤ºDEPOSITç±»å‹ï¼‰
   - åªè¯»ï¼Œç°è‰²æ–‡å­—ï¼Œç”¨äºå‚è€ƒ
   - æ ¼å¼ï¼š`$2,500`
   - ç›®çš„ï¼šå¸®åŠ©ç”¨æˆ·äº†è§£å†å²æŠ•å…¥è¶‹åŠ¿

3. **æœ¬æœˆæŠ•å…¥åˆ—ï¼ˆcol-span-2ï¼‰**:
   - è¾“å…¥æ¡†ï¼Œå¯ç¼–è¾‘
   - å¸¦è´§å¸ç¬¦å·ï¼ˆæ ¹æ®è´¦æˆ·å¸ç§ï¼‰
   - å ä½ç¬¦ï¼š`0.00`

4. **æœ¬æœˆå–å‡ºåˆ—ï¼ˆcol-span-2ï¼‰**:
   - è¾“å…¥æ¡†ï¼Œå¯ç¼–è¾‘
   - å¸¦è´§å¸ç¬¦å·ï¼ˆæ ¹æ®è´¦æˆ·å¸ç§ï¼‰
   - å ä½ç¬¦ï¼š`0.00`

**æ•°æ®è¡Œå¸ƒå±€**:
```html
<div class="grid grid-cols-12 gap-3 px-4 py-2.5 hover:bg-gray-50">
  <!-- è´¦æˆ·ä¿¡æ¯ -->
  <div class="col-span-3">
    <div class="flex items-center gap-2">
      <span class="text-lg">{{ account.categoryIcon }}</span>
      <div>
        <div class="font-medium text-sm">
          {{ account.categoryName }} - {{ account.accountName }}
        </div>
        <div class="text-xs text-gray-500">
          å¸ç§: {{ account.currency }} | æŒæœ‰äºº: {{ account.holderName }}
        </div>
      </div>
    </div>
  </div>

  <!-- å‰3ä¸ªæœˆå†å²æŠ•å…¥ï¼ˆåªè¯»ï¼‰ -->
  <div class="col-span-2 text-right text-sm text-gray-600">
    {{ formatCurrency(historyData[account.id]?.month3Deposit ?? 0) }}
  </div>
  <div class="col-span-2 text-right text-sm text-gray-600">
    {{ formatCurrency(historyData[account.id]?.month2Deposit ?? 0) }}
  </div>
  <div class="col-span-2 text-right text-sm text-gray-700 font-medium">
    {{ formatCurrency(historyData[account.id]?.month1Deposit ?? 0) }}
  </div>

  <!-- æœ¬æœˆæŠ•å…¥è¾“å…¥æ¡† -->
  <div class="col-span-2">
    <div class="relative">
      <span class="absolute left-2 top-2 text-gray-500 text-sm">
        {{ getCurrencySymbol(account.currency) }}
      </span>
      <input
        v-model="depositAmounts[account.id]"
        type="number"
        step="0.01"
        min="0"
        placeholder="0.00"
        class="w-full pl-6 pr-2 py-1.5 text-sm border rounded"
        @input="markAsChanged(account.id)"
      />
    </div>
  </div>

  <!-- æœ¬æœˆå–å‡ºè¾“å…¥æ¡† -->
  <div class="col-span-2">
    <div class="relative">
      <span class="absolute left-2 top-2 text-gray-500 text-sm">
        {{ getCurrencySymbol(account.currency) }}
      </span>
      <input
        v-model="withdrawalAmounts[account.id]"
        type="number"
        step="0.01"
        min="0"
        placeholder="0.00"
        class="w-full pl-6 pr-2 py-1.5 text-sm border rounded"
        @input="markAsChanged(account.id)"
      />
    </div>
  </div>
</div>
```

#### 3. åº•éƒ¨ç»Ÿè®¡åŒº

```html
<div class="px-4 py-4 border-t bg-gray-50">
  <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
    <div>
      <div class="text-xs text-gray-600 mb-1">æœ¬æœˆæ€»æŠ•å…¥</div>
      <div class="text-2xl font-bold text-green-600">
        {{ formatCurrency(summary.totalDeposits) }}
      </div>
    </div>
    <div>
      <div class="text-xs text-gray-600 mb-1">æœ¬æœˆæ€»å–å‡º</div>
      <div class="text-2xl font-bold text-red-600">
        {{ formatCurrency(summary.totalWithdrawals) }}
      </div>
    </div>
    <div>
      <div class="text-xs text-gray-600 mb-1">å‡€æŠ•å…¥</div>
      <div class="text-2xl font-bold text-blue-600">
        {{ formatCurrency(summary.netDeposits) }}
      </div>
    </div>
  </div>
</div>
```

**ç»Ÿè®¡è¯´æ˜**:
- **æœ¬æœˆæ€»æŠ•å…¥**: æ‰€æœ‰è´¦æˆ·æŠ•å…¥é‡‘é¢æ€»å’Œ
- **æœ¬æœˆæ€»å–å‡º**: æ‰€æœ‰è´¦æˆ·å–å‡ºé‡‘é¢æ€»å’Œ
- **å‡€æŠ•å…¥**: æ€»æŠ•å…¥ - æ€»å–å‡º

#### 4. æ•°æ®åŠ è½½å’Œä¿å­˜é€»è¾‘

**æ•°æ®åŠ è½½**:
```javascript
// 1. åŠ è½½æŠ•èµ„è´¦æˆ·åˆ—è¡¨
async function loadInvestmentAccounts() {
  // è·å–è¯¥å®¶åº­æ‰€æœ‰æŠ•èµ„è´¦æˆ·ï¼ˆis_investment = TRUEï¼‰
  const accounts = await fetchInvestmentAccounts(selectedFamilyId)
  // æŒ‰å¤§ç±»åˆ†ç»„æ’åº
}

// 2. åŠ è½½å‰3ä¸ªæœˆå†å²æ•°æ®
async function loadHistoryData() {
  const periods = [
    getPreviousPeriod(transactionPeriod, 3),
    getPreviousPeriod(transactionPeriod, 2),
    getPreviousPeriod(transactionPeriod, 1)
  ]

  // å¹¶è¡ŒåŠ è½½3ä¸ªæœˆçš„æ•°æ®
  const results = await Promise.all(
    periods.map(period =>
      fetchTransactionsByPeriod(selectedFamilyId, period)
    )
  )

  // åªæå–æŠ•å…¥é‡‘é¢ï¼ˆDEPOSITï¼‰ç”¨äºæ˜¾ç¤ºå†å²è¶‹åŠ¿
  results.forEach((records, index) => {
    records.filter(r => r.transactionType === 'DEPOSIT').forEach(record => {
      historyData[record.accountId][`month${3-index}Deposit`] = record.amount
    })
  })
}

// 3. åŠ è½½æœ¬æœˆæ•°æ®
async function loadCurrentMonthData() {
  const records = await fetchTransactionsByPeriod(
    selectedFamilyId,
    transactionPeriod
  )

  // åˆ†åˆ«å¡«å……æŠ•å…¥å’Œå–å‡º
  records.forEach(record => {
    if (record.transactionType === 'DEPOSIT') {
      depositAmounts[record.accountId] = record.amount
      depositRecordIds[record.accountId] = record.id
    } else if (record.transactionType === 'WITHDRAWAL') {
      withdrawalAmounts[record.accountId] = record.amount
      withdrawalRecordIds[record.accountId] = record.id
    }
  })
}
```

**ä¿å­˜é€»è¾‘**:
```javascript
async function saveAll() {
  const transactionsToSave = []
  const transactionsToDelete = []

  // éå†æ‰€æœ‰è´¦æˆ·
  changedAccounts.forEach(accountId => {
    const depositAmount = parseFloat(depositAmounts[accountId] || 0)
    const withdrawalAmount = parseFloat(withdrawalAmounts[accountId] || 0)

    // å¤„ç†æŠ•å…¥è®°å½•
    if (depositAmount > 0) {
      transactionsToSave.push({
        accountId,
        transactionPeriod,
        transactionType: 'DEPOSIT',
        amount: depositAmount
      })
    } else if (depositRecordIds[accountId]) {
      // æœ‰åŸè®°å½•ä½†ç°åœ¨ä¸º0ï¼Œåˆ é™¤
      transactionsToDelete.push(depositRecordIds[accountId])
    }

    // å¤„ç†å–å‡ºè®°å½•
    if (withdrawalAmount > 0) {
      transactionsToSave.push({
        accountId,
        transactionPeriod,
        transactionType: 'WITHDRAWAL',
        amount: withdrawalAmount
      })
    } else if (withdrawalRecordIds[accountId]) {
      // æœ‰åŸè®°å½•ä½†ç°åœ¨ä¸º0ï¼Œåˆ é™¤
      transactionsToDelete.push(withdrawalRecordIds[accountId])
    }
  })

  // æ‰¹é‡ä¿å­˜å’Œåˆ é™¤
  await batchSaveTransactions(transactionsToSave)
  await batchDeleteTransactions(transactionsToDelete)
}
```

#### 5. è´¦æˆ·æ’åºè§„åˆ™

**æ’åºä¼˜å…ˆçº§**:
1. **æŒ‰å¤§ç±»æ’åº**: è‚¡ç¥¨æŠ•èµ„ > é€€ä¼‘åŸºé‡‘ > æ•°å­—è´§å¸ï¼ˆæ ¹æ®å¤§ç±»IDæˆ–è‡ªå®šä¹‰é¡ºåºï¼‰
2. **åŒå¤§ç±»å†…æ’åº**:
   - æœ‰å†å²æŠ•å…¥è®°å½•çš„è´¦æˆ·æ’åœ¨å‰é¢
   - æ— å†å²è®°å½•çš„æ’åœ¨åé¢
   - åŒçº§åˆ«å†…æŒ‰è´¦æˆ·IDæ’åº

**ç¤ºä¾‹**:
```
ğŸ“ˆ è‚¡ç¥¨æŠ•èµ„
  â”œâ”€ Fidelity 401k (æœ‰å†å²è®°å½•ï¼Œæ’æœ€å‰)
  â”œâ”€ Charles Schwab (æœ‰å†å²è®°å½•)
  â””â”€ New Account (æ— å†å²è®°å½•ï¼Œæ’æœ€å)

ğŸ¦ é€€ä¼‘åŸºé‡‘
  â”œâ”€ Vanguard IRA (æœ‰å†å²è®°å½•)
  â””â”€ Traditional IRA (æ— å†å²è®°å½•)
```

#### 6. äº¤äº’ç‰¹ç‚¹

**ä¸æ”¯å‡ºç®¡ç†æ‰¹é‡å½•å…¥çš„åŒºåˆ«**:
| é¡¹ç›® | æ”¯å‡ºç®¡ç† | æŠ•èµ„ç®¡ç† |
|------|---------|---------|
| åˆ—è¡¨é¡¹ | æ”¯å‡ºå­åˆ†ç±» | æŠ•èµ„è´¦æˆ· |
| è¾“å…¥åˆ—æ•° | 1åˆ—ï¼ˆé‡‘é¢ï¼‰ | 2åˆ—ï¼ˆæŠ•å…¥ + å–å‡ºï¼‰ |
| å†å²æ•°æ® | å‰3æœˆæ”¯å‡º | å‰3æœˆæŠ•å…¥ |
| ç±»å‹æ ‡ç­¾ | å›ºå®šæ—¥å¸¸/å¤§é¢ä¸å®šæœŸ | æ— éœ€æ˜¾ç¤º |
| è´§å¸é€‰æ‹© | å•ä¸€è´§å¸ | æ¯è´¦æˆ·ç‹¬ç«‹å¸ç§ |
| åº•éƒ¨ç»Ÿè®¡ | æ€»æ”¯å‡º + åˆ†ç±»å æ¯” | æ€»æŠ•å…¥ + æ€»å–å‡º + å‡€æŠ•å…¥ |

**æ³¨æ„äº‹é¡¹**:
1. **å¤šå¸ç§å¤„ç†**: æ¯ä¸ªè´¦æˆ·æœ‰è‡ªå·±çš„å¸ç§ï¼Œè¾“å…¥æ¡†å‰æ˜¾ç¤ºå¯¹åº”å¸ç§ç¬¦å·
2. **æŠ•å…¥/å–å‡ºåˆ†ç¦»**:
   - æŠ•å…¥é‡‘é¢ > 0 â†’ åˆ›å»ºDEPOSITè®°å½•
   - å–å‡ºé‡‘é¢ > 0 â†’ åˆ›å»ºWITHDRAWALè®°å½•
   - ä¸€ä¸ªè´¦æˆ·å¯ä»¥åŒæ—¶æœ‰æŠ•å…¥å’Œå–å‡ºï¼Œç”Ÿæˆä¸¤æ¡è®°å½•
3. **å†å²æ•°æ®**: åªæ˜¾ç¤ºå‰3æœˆçš„æŠ•å…¥é‡‘é¢ï¼ˆä¸æ˜¾ç¤ºå–å‡ºï¼‰ï¼Œç”¨äºå‚è€ƒå®šæŠ•è¶‹åŠ¿
4. **ç»Ÿè®¡æ±‡æ€»**: åº•éƒ¨æ˜¾ç¤ºæ‰€æœ‰è´¦æˆ·çš„æ€»æŠ•å…¥ã€æ€»å–å‡ºã€å‡€æŠ•å…¥ï¼ˆéœ€è¦è¿›è¡Œå¸ç§è½¬æ¢æˆ–åˆ†å¸ç§ç»Ÿè®¡ï¼‰

### 3.3 åˆ†æ-æŠ•èµ„åˆ†æ-å¹´åº¦æŠ•èµ„

**é¡µé¢è·¯å¾„**: `/analysis/investment/annual`

**é¡µé¢å¸ƒå±€**: å®Œå…¨å‚ç…§"åˆ†æ-æ”¯å‡ºåˆ†æ-å¹´åº¦æ”¯å‡º"ï¼ˆExpenseAnnual.vueï¼‰çš„å¸ƒå±€è®¾è®¡

#### é¡µé¢ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¹´åº¦æŠ•èµ„åˆ†æ                [å®¶åº­â–¼] [å¹´ä»½â–¼] [å¸ç§â–¼]         â”‚
â”‚  åˆ†æå¹´åº¦æŠ•èµ„ç»“æ„å’Œå‡€æŠ•å…¥æƒ…å†µ                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ å¤§ç±»åˆ†å¸ƒ (å·¦ä¾§, è·¨2è¡Œ) â”‚  â”‚ ğŸ“ˆè‚¡ç¥¨æŠ•èµ„ - è´¦æˆ·åˆ†å¸ƒ   â”‚   â”‚
â”‚  â”‚                       â”‚  â”‚ (å³ä¸Š)                   â”‚   â”‚
â”‚  â”‚ [å¤§ç±»é¥¼å›¾]            â”‚  â”‚ [é¥¼å›¾] â”‚ [è´¦æˆ·è¡¨æ ¼]     â”‚   â”‚
â”‚  â”‚                       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”‚                       â”‚                                 â”‚
â”‚  â”‚ [å¤§ç±»è¡¨æ ¼]            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ åˆ†ç±» â”‚å‡€æŠ•å…¥â”‚å æ¯”    â”‚  â”‚ Fidelity 401k - æœˆåº¦è¶‹åŠ¿â”‚   â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€    â”‚  â”‚ (å³ä¸‹)                   â”‚   â”‚
â”‚  â”‚ ğŸ“ˆè‚¡ç¥¨â”‚$XX   â”‚60% â—„ç‚¹å‡»â”‚  â”‚                         â”‚   â”‚
â”‚  â”‚ ğŸ¦é€€ä¼‘â”‚$XX   â”‚32%     â”‚  â”‚ [æŸ±çŠ¶å›¾: æŠ•å…¥/å–å‡º]     â”‚   â”‚
â”‚  â”‚ ğŸ’æ•°å­—â”‚$XX   â”‚8%      â”‚  â”‚                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 1. é¡¶éƒ¨ç­›é€‰æ§åˆ¶åŒº

**æ§åˆ¶é¡¹**ï¼ˆæ¨ªå‘æ’åˆ—ï¼‰:
```html
<div class="flex items-center gap-4">
  <!-- å®¶åº­é€‰æ‹© -->
  <select v-model="selectedFamilyId">
    <option v-for="family in families" :value="family.id">
      {{ family.familyName }}
    </option>
  </select>

  <!-- å¹´ä»½é€‰æ‹© -->
  <select v-model="selectedYear">
    <option v-for="year in availableYears" :value="year">
      {{ year }}å¹´
    </option>
  </select>

  <!-- å¸ç§é€‰æ‹© -->
  <select v-model="selectedCurrency">
    <option value="All">All</option>
    <option value="USD">USD</option>
    <option value="CNY">CNY</option>
  </select>
</div>
```

**å¹´ä»½èŒƒå›´**: å½“å‰å¹´ä»½å¾€å‰æ¨10å¹´

#### 2. Gridå¸ƒå±€ï¼ˆgrid-cols-12ï¼‰

**å·¦ä¾§åŒºåŸŸï¼ˆcol-span-6, row-span-2ï¼‰: å¤§ç±»åˆ†å¸ƒ**

```html
<div class="col-span-12 lg:col-span-6 lg:row-span-2 bg-white rounded-lg shadow border p-6">
  <h3 class="text-lg font-semibold mb-4">å¤§ç±»åˆ†å¸ƒ</h3>

  <!-- å¤§ç±»é¥¼å›¾ -->
  <div class="mb-6 h-96 lg:h-[400px]">
    <canvas ref="majorCategoryChartCanvas"></canvas>
  </div>

  <!-- å¤§ç±»è¡¨æ ¼ -->
  <div class="overflow-auto">
    <table class="min-w-full">
      <thead class="bg-gray-50 sticky top-0">
        <tr>
          <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">
            åˆ†ç±»
          </th>
          <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">
            å‡€æŠ•å…¥
          </th>
          <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">
            å æ¯”
          </th>
        </tr>
      </thead>
      <tbody>
        <tr
          v-for="item in majorCategoryData"
          :key="item.categoryId"
          @click="selectMajorCategory(item)"
          class="cursor-pointer hover:bg-gray-50"
        >
          <td class="px-4 py-3">
            <span class="text-xl mr-2">{{ item.categoryIcon }}</span>
            {{ item.categoryName }}
          </td>
          <td class="px-4 py-3 text-right font-medium">
            {{ formatCurrency(item.netDeposits) }}
          </td>
          <td class="px-4 py-3 text-right text-gray-600">
            {{ ((item.netDeposits / totalNetDeposits) * 100).toFixed(1) }}%
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
```

**é¥¼å›¾é…ç½®**:
- ç±»å‹ï¼špie
- æ•°æ®ï¼šå„å¤§ç±»çš„å‡€æŠ•å…¥é‡‘é¢ï¼ˆæŠ•å…¥ - å–å‡ºï¼‰
- æ ‡ç­¾ï¼šåªæ˜¾ç¤ºå æ¯” >= 5% çš„åˆ†ç±»åç§°å’Œç™¾åˆ†æ¯”
- é¢œè‰²ï¼š10ç§é¢œè‰²å¾ªç¯ä½¿ç”¨
- å›¾ä¾‹ï¼šåº•éƒ¨æ˜¾ç¤º

**è¡¨æ ¼è¯´æ˜**:
- **å‡€æŠ•å…¥** = è¯¥å¤§ç±»æ‰€æœ‰è´¦æˆ·çš„æŠ•å…¥æ€»é¢ - å–å‡ºæ€»é¢
- **å æ¯”** = è¯¥å¤§ç±»å‡€æŠ•å…¥ / æ‰€æœ‰å¤§ç±»å‡€æŠ•å…¥æ€»å’Œ

**å³ä¾§ä¸Šæ–¹åŒºåŸŸï¼ˆcol-span-6ï¼‰: è´¦æˆ·åˆ†å¸ƒï¼ˆé’»å–åæ˜¾ç¤ºï¼‰**

```html
<div
  v-if="selectedMajorCategoryId"
  class="col-span-12 lg:col-span-6 bg-white rounded-lg shadow border p-6"
>
  <h3 class="text-lg font-semibold mb-3">
    {{ selectedMajorCategoryName }} - è´¦æˆ·åˆ†å¸ƒ
  </h3>

  <!-- é¥¼å›¾å’Œè¡¨æ ¼æ¨ªå‘æ’åˆ— -->
  <div class="flex flex-col lg:flex-row gap-4">
    <!-- å·¦ä¾§ï¼šè´¦æˆ·é¥¼å›¾ -->
    <div class="flex-shrink-0 w-full lg:w-[280px] h-64 lg:h-[280px]">
      <canvas ref="accountChartCanvas"></canvas>
    </div>

    <!-- å³ä¾§ï¼šè´¦æˆ·è¡¨æ ¼ -->
    <div class="flex-1 overflow-auto" style="max-height: 280px;">
      <table class="min-w-full">
        <thead class="bg-gray-50 sticky top-0">
          <tr>
            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">
              è´¦æˆ·
            </th>
            <th class="px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase">
              å‡€æŠ•å…¥
            </th>
          </tr>
        </thead>
        <tbody>
          <tr
            v-for="item in accountData"
            :key="item.accountId"
            @click="selectAccount(item)"
            class="cursor-pointer hover:bg-gray-50"
          >
            <td class="px-3 py-2">
              <div class="font-medium">{{ item.accountName }}</div>
              <div class="text-xs text-gray-500 mt-1">
                {{ ((item.netDeposits / accountTotal) * 100).toFixed(1) }}%
              </div>
            </td>
            <td class="px-3 py-2 text-right font-medium">
              {{ formatCurrency(item.netDeposits) }}
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
```

**è´¦æˆ·é¥¼å›¾é…ç½®**:
- ç±»å‹ï¼špie
- æ•°æ®ï¼šé€‰ä¸­å¤§ç±»ä¸‹å„æŠ•èµ„è´¦æˆ·çš„å‡€æŠ•å…¥é‡‘é¢
- æ ‡ç­¾ï¼šåªæ˜¾ç¤ºå æ¯” >= 8% çš„è´¦æˆ·åç§°å’Œç™¾åˆ†æ¯”

**è´¦æˆ·è¡¨æ ¼è¯´æ˜**:
- **å‡€æŠ•å…¥** = è¯¥è´¦æˆ·çš„æŠ•å…¥æ€»é¢ - å–å‡ºæ€»é¢
- **å æ¯”** = è¯¥è´¦æˆ·å‡€æŠ•å…¥ / è¯¥å¤§ç±»å‡€æŠ•å…¥æ€»å’Œ

**å³ä¾§ä¸‹æ–¹åŒºåŸŸï¼ˆcol-span-6ï¼‰: æœˆåº¦è¶‹åŠ¿ï¼ˆé’»å–åæ˜¾ç¤ºï¼‰**

```html
<div
  v-if="selectedAccountId"
  class="col-span-12 lg:col-span-6 bg-white rounded-lg shadow border p-6"
>
  <h3 class="text-lg font-semibold mb-3">
    {{ selectedAccountName }} - æœˆåº¦è¶‹åŠ¿
  </h3>
  <div class="h-72 lg:h-[300px]">
    <canvas ref="monthlyTrendChartCanvas"></canvas>
  </div>
</div>
```

**æœˆåº¦è¶‹åŠ¿æŸ±çŠ¶å›¾é…ç½®**:
- ç±»å‹ï¼šbarï¼ˆåˆ†ç»„æŸ±çŠ¶å›¾ï¼‰
- Xè½´ï¼š1-12æœˆ
- Yè½´ï¼šé‡‘é¢
- æ•°æ®é›†1ï¼šæŠ•å…¥é‡‘é¢ï¼ˆç»¿è‰²æŸ±ï¼‰
- æ•°æ®é›†2ï¼šå–å‡ºé‡‘é¢ï¼ˆçº¢è‰²æŸ±ï¼‰

```javascript
{
  type: 'bar',
  data: {
    labels: ['1æœˆ', '2æœˆ', ..., '12æœˆ'],
    datasets: [
      {
        label: 'æŠ•å…¥',
        data: [2500, 2500, ...],  // æ¯æœˆDEPOSITé‡‘é¢
        backgroundColor: '#10b981'  // ç»¿è‰²
      },
      {
        label: 'å–å‡º',
        data: [0, 0, 500, ...],  // æ¯æœˆWITHDRAWALé‡‘é¢
        backgroundColor: '#ef4444'  // çº¢è‰²
      }
    ]
  }
}
```

#### 3. äº¤äº’æµç¨‹

**åˆå§‹åŠ è½½**:
1. åŠ è½½å®¶åº­åˆ—è¡¨ï¼Œé»˜è®¤é€‰ä¸­ç¬¬ä¸€ä¸ªå®¶åº­
2. åŠ è½½è´§å¸åˆ—è¡¨ï¼ˆåŒ…å«"All"é€‰é¡¹ï¼‰
3. é»˜è®¤å¹´ä»½ä¸ºå½“å‰å¹´ä»½
4. åŠ è½½å¤§ç±»åˆ†å¸ƒæ•°æ®
5. æ¸²æŸ“å¤§ç±»é¥¼å›¾å’Œè¡¨æ ¼

**ç‚¹å‡»å¤§ç±»**:
1. è®°å½•é€‰ä¸­çš„å¤§ç±»IDå’Œåç§°
2. æ¸…ç©ºä¹‹å‰é€‰ä¸­çš„è´¦æˆ·
3. åŠ è½½è¯¥å¤§ç±»ä¸‹çš„æ‰€æœ‰æŠ•èµ„è´¦æˆ·æ•°æ®
4. æ¸²æŸ“è´¦æˆ·é¥¼å›¾å’Œè¡¨æ ¼
5. æ˜¾ç¤ºå³ä¸Šæ–¹çš„è´¦æˆ·åˆ†å¸ƒåŒºåŸŸ

**ç‚¹å‡»è´¦æˆ·**:
1. è®°å½•é€‰ä¸­çš„è´¦æˆ·IDå’Œåç§°
2. åŠ è½½è¯¥è´¦æˆ·çš„æœˆåº¦æŠ•å…¥/å–å‡ºæ•°æ®
3. æ¸²æŸ“æœˆåº¦è¶‹åŠ¿æŸ±çŠ¶å›¾
4. æ˜¾ç¤ºå³ä¸‹æ–¹çš„æœˆåº¦è¶‹åŠ¿åŒºåŸŸ

**åˆ‡æ¢ç­›é€‰æ¡ä»¶**ï¼ˆå®¶åº­/å¹´ä»½/å¸ç§ï¼‰:
1. é‡æ–°åŠ è½½å¤§ç±»æ•°æ®
2. æ¸…ç©ºé€‰ä¸­çš„å¤§ç±»å’Œè´¦æˆ·
3. éšè—å³ä¾§ä¸Šä¸‹ä¸¤ä¸ªåŒºåŸŸ
4. é‡æ–°æ¸²æŸ“å¤§ç±»é¥¼å›¾å’Œè¡¨æ ¼

#### 4. æ•°æ®åŠ è½½é€»è¾‘

**APIè°ƒç”¨é¡ºåº**:
```javascript
// 1. åˆå§‹åŠ è½½
await loadFamilies()
await loadCurrencies()
await loadMajorCategoryData()

// 2. é€‰ä¸­å¤§ç±»
async function selectMajorCategory(item) {
  selectedMajorCategoryId = item.categoryId
  selectedMajorCategoryName = item.categoryName

  // æ¸…ç©ºè´¦æˆ·é€‰æ‹©
  selectedAccountId = null

  // åŠ è½½è¯¥å¤§ç±»ä¸‹çš„è´¦æˆ·æ•°æ®
  const response = await investmentAnalysisAPI.getAnnualAccountsByCategory(
    selectedFamilyId, selectedYear, item.categoryId, selectedCurrency
  )

  accountData = response.data
  updateAccountChart()
}

// 3. é€‰ä¸­è´¦æˆ·
async function selectAccount(item) {
  selectedAccountId = item.accountId
  selectedAccountName = item.accountName

  // åŠ è½½è¯¥è´¦æˆ·çš„æœˆåº¦è¶‹åŠ¿
  const response = await investmentAnalysisAPI.getAccountMonthlyTrend(
    item.accountId, selectedYear
  )

  monthlyTrendData = response.data
  updateMonthlyTrendChart()
}
```

#### 5. æ•°æ®è®¡ç®—è¯´æ˜

**å¤§ç±»å‡€æŠ•å…¥è®¡ç®—**:
```sql
-- æŒ‰å¤§ç±»æ±‡æ€»
SELECT
    c.id as category_id,
    c.name as category_name,
    c.icon as category_icon,
    COALESCE(SUM(CASE WHEN t.transaction_type = 'DEPOSIT' THEN t.amount ELSE 0 END), 0) as total_deposits,
    COALESCE(SUM(CASE WHEN t.transaction_type = 'WITHDRAWAL' THEN t.amount ELSE 0 END), 0) as total_withdrawals,
    COALESCE(SUM(CASE WHEN t.transaction_type = 'DEPOSIT' THEN t.amount ELSE 0 END), 0) -
    COALESCE(SUM(CASE WHEN t.transaction_type = 'WITHDRAWAL' THEN t.amount ELSE 0 END), 0) as net_deposits
FROM asset_categories c
JOIN asset_accounts a ON c.id = a.category_id
LEFT JOIN investment_transactions t ON a.id = t.account_id
    AND t.transaction_period LIKE '2024-%'
WHERE c.is_investment = TRUE
  AND a.user_id IN (SELECT user_id FROM family_members WHERE family_id = ?)
GROUP BY c.id, c.name, c.icon
ORDER BY net_deposits DESC
```

**è´¦æˆ·å‡€æŠ•å…¥è®¡ç®—**ï¼ˆæŸä¸ªå¤§ç±»ä¸‹ï¼‰:
```sql
SELECT
    a.id as account_id,
    a.account_name,
    COALESCE(SUM(CASE WHEN t.transaction_type = 'DEPOSIT' THEN t.amount ELSE 0 END), 0) as total_deposits,
    COALESCE(SUM(CASE WHEN t.transaction_type = 'WITHDRAWAL' THEN t.amount ELSE 0 END), 0) as total_withdrawals,
    COALESCE(SUM(CASE WHEN t.transaction_type = 'DEPOSIT' THEN t.amount ELSE 0 END), 0) -
    COALESCE(SUM(CASE WHEN t.transaction_type = 'WITHDRAWAL' THEN t.amount ELSE 0 END), 0) as net_deposits
FROM asset_accounts a
LEFT JOIN investment_transactions t ON a.id = t.account_id
    AND t.transaction_period LIKE '2024-%'
WHERE a.category_id = ?
  AND a.user_id IN (SELECT user_id FROM family_members WHERE family_id = ?)
GROUP BY a.id, a.account_name
ORDER BY net_deposits DESC
```

**æœˆåº¦è¶‹åŠ¿è®¡ç®—**ï¼ˆæŸä¸ªè´¦æˆ·ï¼‰:
```sql
-- è·å–1-12æœˆçš„æŠ•å…¥å’Œå–å‡º
SELECT
    MONTH(CONCAT(t.transaction_period, '-01')) as month,
    SUM(CASE WHEN t.transaction_type = 'DEPOSIT' THEN t.amount ELSE 0 END) as deposits,
    SUM(CASE WHEN t.transaction_type = 'WITHDRAWAL' THEN t.amount ELSE 0 END) as withdrawals
FROM investment_transactions t
WHERE t.account_id = ?
  AND t.transaction_period LIKE '2024-%'
GROUP BY MONTH(CONCAT(t.transaction_period, '-01'))
ORDER BY month
```

#### 6. å…³é”®å·®å¼‚è¯´æ˜

**ä¸æ”¯å‡ºåˆ†æçš„åŒºåˆ«**:
| é¡¹ç›® | æ”¯å‡ºåˆ†æ | æŠ•èµ„åˆ†æ |
|------|---------|---------|
| å¤§ç±»æ•°æ®æº | expense_category_major | asset_categories (is_investment=TRUE) |
| å°ç±»å±‚çº§ | æ”¯å‡ºå°ç±» | æŠ•èµ„è´¦æˆ· |
| æ•°æ®è¡¨ | expense_records | investment_transactions |
| é‡‘é¢å­—æ®µ | amountï¼ˆå•ä¸€ï¼‰ | amountï¼ˆåŒºåˆ†DEPOSIT/WITHDRAWALï¼‰ |
| èšåˆæŒ‡æ ‡ | æ€»æ”¯å‡º | å‡€æŠ•å…¥ï¼ˆæŠ•å…¥-å–å‡ºï¼‰ |
| æœˆåº¦è¶‹åŠ¿ | å•æŸ±çŠ¶å›¾ï¼ˆæ”¯å‡ºï¼‰ | åŒæŸ±çŠ¶å›¾ï¼ˆæŠ•å…¥+å–å‡ºï¼‰ |
| é¢œè‰²æ–¹æ¡ˆ | å•è‰²ç³» | ç»¿è‰²ï¼ˆæŠ•å…¥ï¼‰+ çº¢è‰²ï¼ˆå–å‡ºï¼‰ |

#### 7. å“åº”å¼è®¾è®¡

**ç§»åŠ¨ç«¯é€‚é…**:
- å·¦ä¾§å¤§ç±»åŒºåŸŸï¼šcol-span-12ï¼ˆå°å±å¹•å æ»¡å®½ï¼‰
- å³ä¾§åŒºåŸŸï¼šcol-span-12ï¼ˆå°å±å¹•å æ»¡å®½ï¼Œçºµå‘å †å ï¼‰
- é¥¼å›¾å’Œè¡¨æ ¼ï¼šlg:flex-rowï¼ˆå¤§å±æ¨ªå‘ï¼‰ï¼Œé»˜è®¤flex-colï¼ˆå°å±çºµå‘ï¼‰
- å­—ä½“å¤§å°ï¼štext-xs md:text-smï¼ˆå°å±æ›´å°ï¼‰
## 4. APIè®¾è®¡

### 4.1 æŠ•èµ„äº¤æ˜“API

**Base Path**: `/api/investments`

#### 4.1.1 è·å–æŠ•èµ„è´¦æˆ·åˆ—è¡¨
```
GET /investments/accounts?familyId={familyId}

Response:
{
  "success": true,
  "data": [
    {
      "accountId": 1,
      "accountName": "Fidelity 401k",
      "categoryId": 24,
      "categoryName": "è‚¡ç¥¨æŠ•èµ„",
      "categoryType": "STOCKS",
      "userId": 1,
      "userName": "å¼ ä¸‰",
      "currency": "USD",
      "institution": "Fidelity"
    }
  ]
}
```

#### 4.1.2 è·å–æŠ•èµ„äº¤æ˜“è®°å½•
```
GET /investments/transactions?familyId={familyId}&year={year}&month={month}

Response:
{
  "success": true,
  "data": [
    {
      "id": 1,
      "accountId": 1,
      "accountName": "Fidelity 401k",
      "categoryName": "è‚¡ç¥¨æŠ•èµ„",
      "userId": 1,
      "userName": "å¼ ä¸‰",
      "transactionPeriod": "2024-01",
      "transactionType": "DEPOSIT",
      "amount": 2500.00,
      "currency": "USD",  // ä»asset_accountsè·å–
      "description": "æœˆåº¦å®šæŠ•"
    }
  ]
}
```

#### 4.1.3 åˆ›å»ºæŠ•èµ„äº¤æ˜“
```
POST /investments/transactions

Request:
{
  "accountId": 1,
  "transactionPeriod": "2024-01",
  "transactionType": "DEPOSIT",
  "amount": 2500.00,
  "description": "æœˆåº¦å®šæŠ•"
}

Response:
{
  "success": true,
  "message": "æŠ•èµ„äº¤æ˜“è®°å½•åˆ›å»ºæˆåŠŸ",
  "data": { ... }
}

æ³¨ï¼šåç«¯ä»account_idè‡ªåŠ¨è·å–user_idå’Œcurrencyä¿¡æ¯
```

#### 4.1.4 æ‰¹é‡ä¿å­˜æŠ•èµ„äº¤æ˜“
```
POST /investments/transactions/batch

Request:
{
  "familyId": 1,
  "transactionPeriod": "2024-01",
  "transactions": [
    {
      "accountId": 1,
      "deposits": 2500.00,
      "withdrawals": 0,
      "description": "æœˆåº¦å®šæŠ•"
    },
    {
      "accountId": 2,
      "deposits": 1500.00,
      "withdrawals": 500.00,
      "description": "è°ƒä»“æ“ä½œ"
    }
  ]
}

Response:
{
  "success": true,
  "message": "æ‰¹é‡ä¿å­˜æˆåŠŸ",
  "data": {
    "created": 3,
    "updated": 1
  }
}
```

#### 4.1.5 æ›´æ–°æŠ•èµ„äº¤æ˜“
```
PUT /investments/transactions/{id}

Request: (åŒåˆ›å»º)

Response:
{
  "success": true,
  "message": "æŠ•èµ„äº¤æ˜“è®°å½•æ›´æ–°æˆåŠŸ"
}
```

#### 4.1.6 åˆ é™¤æŠ•èµ„äº¤æ˜“
```
DELETE /investments/transactions/{id}

Response:
{
  "success": true,
  "message": "æŠ•èµ„äº¤æ˜“è®°å½•åˆ é™¤æˆåŠŸ"
}
```

### 4.2 æŠ•èµ„åˆ†æAPI

**Base Path**: `/api/investments/analysis`

#### 4.2.1 è·å–å¹´åº¦æŠ•èµ„æ±‡æ€»
```
GET /investments/analysis/annual/summary?familyId={familyId}&year={year}&currency={currency}

Response:
{
  "success": true,
  "data": {
    "year": 2024,
    "currency": "USD",
    "beginningValue": 450000.00,
    "endingValue": 523450.00,
    "totalDeposits": 65000.00,
    "totalWithdrawals": 12500.00,
    "netDeposits": 52500.00,
    "investmentReturn": 20950.00,
    "returnRate": 4.66
  }
}
```

#### 4.2.2 è·å–å¤§ç±»æŠ•èµ„åˆ†æ
```
GET /investments/analysis/annual/by-category?familyId={familyId}&year={year}&currency={currency}

Response:
{
  "success": true,
  "data": [
    {
      "categoryId": 24,
      "categoryName": "è‚¡ç¥¨æŠ•èµ„",
      "categoryIcon": "ğŸ“ˆ",
      "beginningValue": 250000.00,
      "endingValue": 280500.00,
      "totalDeposits": 35000.00,
      "totalWithdrawals": 0,
      "netDeposits": 35000.00,
      "investmentReturn": 12500.00,
      "returnRate": 4.66
    }
  ]
}
```

#### 4.2.3 è·å–è´¦æˆ·æŠ•èµ„åˆ†æ
```
GET /investments/analysis/annual/by-account?familyId={familyId}&year={year}&currency={currency}&categoryId={categoryId}

Response:
{
  "success": true,
  "data": [
    {
      "accountId": 1,
      "accountName": "Fidelity 401k",
      "categoryName": "è‚¡ç¥¨æŠ•èµ„",
      "beginningValue": 150000.00,
      "endingValue": 168500.00,
      "totalDeposits": 25000.00,
      "totalWithdrawals": 0,
      "netDeposits": 25000.00,
      "investmentReturn": 5500.00,
      "returnRate": 3.35
    }
  ]
}
```

#### 4.2.4 è·å–è´¦æˆ·æœˆåº¦è¶‹åŠ¿
```
GET /investments/analysis/annual/monthly-trend?accountId={accountId}&year={year}

Response:
{
  "success": true,
  "data": [
    {
      "month": 1,
      "period": "2024-01",
      "deposits": 2500.00,
      "withdrawals": 0,
      "accountValue": 152500.00
    },
    {
      "month": 2,
      "period": "2024-02",
      "deposits": 2500.00,
      "withdrawals": 0,
      "accountValue": 155200.00
    }
  ]
}
```

## 5. ä¸šåŠ¡é€»è¾‘è¯´æ˜

### 5.1 æŠ•èµ„è´¦æˆ·è¯†åˆ«

**è§„åˆ™**:
- èµ„äº§è´¦æˆ·æ‰€å±çš„èµ„äº§å¤§ç±»çš„`is_investment`å­—æ®µä¸ºTRUE
- åœ¨æŠ•èµ„ç®¡ç†ç›¸å…³é¡µé¢ï¼Œåªæ˜¾ç¤ºis_investment=TRUEçš„è´¦æˆ·
- å…³è”å…³ç³»ï¼šaccount_id â†’ asset_accounts â†’ user_id â†’ family_members â†’ family_id

**æ•°æ®åº“æŸ¥è¯¢**:
```sql
-- è·å–æŸä¸ªå®¶åº­çš„æ‰€æœ‰æŠ•èµ„è´¦æˆ·
SELECT
    a.*,
    c.name as category_name,
    c.icon as category_icon,
    u.name as user_name
FROM asset_accounts a
JOIN asset_categories c ON a.category_id = c.id
JOIN users u ON a.user_id = u.id
JOIN family_members fm ON u.id = fm.user_id
WHERE c.is_investment = TRUE
  AND fm.family_id = ?
  AND a.is_active = TRUE
```

### 5.2 æŠ•èµ„å›æŠ¥ç‡è®¡ç®—

**æ—¶é—´è·¨åº¦**:
- æœŸåˆï¼šä¸Šä¸€å¹´12æœˆ31æ—¥ï¼ˆå¦‚æŸ¥è¯¢2024å¹´ï¼Œå–2023-12-31ï¼‰
- æœŸæœ«ï¼šæœ¬å¹´12æœˆ31æ—¥ï¼ˆå¦‚æœæ˜¯å½“å¹´ä¸”æœªåˆ°å¹´åº•ï¼Œå–æœ€æ–°å¯ç”¨æ—¥æœŸï¼‰

**è·å–æœŸåˆæœŸæœ«å€¼**:
```sql
-- æœŸåˆå€¼ï¼ˆä¸Šä¸€å¹´12æœˆ31æ—¥ï¼‰
SELECT SUM(amount) as beginning_value
FROM asset_records
WHERE account_id IN (æŠ•èµ„è´¦æˆ·IDåˆ—è¡¨)
  AND record_date = '2023-12-31'

-- æœŸæœ«å€¼ï¼ˆæœ¬å¹´12æœˆ31æ—¥æˆ–æœ€æ–°æ—¥æœŸï¼‰
SELECT SUM(amount) as ending_value
FROM asset_records
WHERE account_id IN (æŠ•èµ„è´¦æˆ·IDåˆ—è¡¨)
  AND record_date = (
    SELECT MAX(record_date)
    FROM asset_records
    WHERE account_id IN (æŠ•èµ„è´¦æˆ·IDåˆ—è¡¨)
      AND record_date <= '2024-12-31'
  )
```

**è®¡ç®—æŠ•å…¥å–å‡º**:
```sql
-- æœ¬å¹´æŠ•å…¥
SELECT SUM(amount) as total_deposits
FROM investment_transactions
WHERE account_id IN (æŠ•èµ„è´¦æˆ·IDåˆ—è¡¨)
  AND transaction_type = 'DEPOSIT'
  AND transaction_period LIKE '2024-%'

-- æœ¬å¹´å–å‡º
SELECT SUM(amount) as total_withdrawals
FROM investment_transactions
WHERE account_id IN (æŠ•èµ„è´¦æˆ·IDåˆ—è¡¨)
  AND transaction_type = 'WITHDRAWAL'
  AND transaction_period LIKE '2024-%'
```

**å›æŠ¥ç‡å…¬å¼**:
```
æŠ•èµ„æ”¶ç›Š = æœŸæœ«æ€»å€¼ - æœŸåˆæ€»å€¼ - å‡€æŠ•å…¥
å¹³å‡èµ„æœ¬ = æœŸåˆæ€»å€¼ + å‡€æŠ•å…¥ / 2
æŠ•èµ„å›æŠ¥ç‡ = (æŠ•èµ„æ”¶ç›Š / å¹³å‡èµ„æœ¬) Ã— 100%
```

**æ³¨æ„äº‹é¡¹**:
- å¦‚æœæœŸåˆå€¼ä¸º0ä¸”å‡€æŠ•å…¥ > 0ï¼Œå›æŠ¥ç‡ = (æŠ•èµ„æ”¶ç›Š / å‡€æŠ•å…¥) Ã— 100%
- å¦‚æœå¹³å‡èµ„æœ¬ <= 0ï¼Œå›æŠ¥ç‡æ ‡è®°ä¸º N/A

### 5.3 å¤šå¸ç§å¤„ç†

**è§„åˆ™**:
- äº¤æ˜“è®°å½•çš„å¸ç§ä»èµ„äº§è´¦æˆ·ç»§æ‰¿ï¼ˆä¸å•ç‹¬å­˜å‚¨ï¼‰
- æ¯ä¸ªèµ„äº§è´¦æˆ·æœ‰å›ºå®šçš„currencyå­—æ®µ
- åˆ†ææ—¶æ”¯æŒæŒ‰å¸ç§æ±‡æ€»æˆ–è½¬æ¢ä¸ºç»Ÿä¸€å¸ç§
- å¦‚æœé€‰æ‹©"All"å¸ç§ï¼š
  - ä½¿ç”¨æ±‡ç‡è¡¨è½¬æ¢ä¸ºåŸºå‡†è´§å¸ï¼ˆUSDï¼‰
  - å¤ç”¨ç°æœ‰çš„exchange_ratesè¡¨å’Œæ±‡ç‡è½¬æ¢é€»è¾‘

**æŸ¥è¯¢ç¤ºä¾‹**:
```sql
-- è·å–äº¤æ˜“è®°å½•çš„å®Œæ•´ä¿¡æ¯ï¼ˆåŒ…æ‹¬user_id, family_id, currencyç­‰ï¼‰
SELECT
    t.*,
    a.user_id,
    a.currency,
    a.account_name,
    u.name as user_name,
    fm.family_id
FROM investment_transactions t
JOIN asset_accounts a ON t.account_id = a.id
JOIN users u ON a.user_id = u.id
JOIN family_members fm ON u.id = fm.user_id
WHERE t.transaction_period LIKE '2024-%'
```

### 5.4 æ‰¹é‡å½•å…¥é€»è¾‘

**ä¿å­˜è§„åˆ™**:
1. æ£€æŸ¥è¯¥æœŸé—´æ˜¯å¦å·²æœ‰è®°å½•
2. å¦‚æœæŠ•å…¥é‡‘é¢ > 0ï¼Œåˆ›å»º/æ›´æ–°DEPOSITè®°å½•
3. å¦‚æœå–å‡ºé‡‘é¢ > 0ï¼Œåˆ›å»º/æ›´æ–°WITHDRAWALè®°å½•
4. å¦‚æœé‡‘é¢ä¸º0æˆ–ç©ºï¼Œä¸åˆ›å»ºè®°å½•ï¼ˆå·²å­˜åœ¨çš„è®°å½•ä¿æŒä¸å˜ï¼‰

**æ›´æ–°ç­–ç•¥**:
```javascript
// ä¼ªä»£ç 
for each account in form:
  existing_deposits = find_transaction(account, period, 'DEPOSIT')
  existing_withdrawals = find_transaction(account, period, 'WITHDRAWAL')

  if form.deposits > 0:
    if existing_deposits:
      update(existing_deposits, amount: form.deposits)
    else:
      create(account, period, 'DEPOSIT', form.deposits)

  if form.withdrawals > 0:
    if existing_withdrawals:
      update(existing_withdrawals, amount: form.withdrawals)
    else:
      create(account, period, 'WITHDRAWAL', form.withdrawals)
```

## 6. ç•Œé¢åŸå‹

### 6.1 ç®¡ç†-æŠ•èµ„ç®¡ç†-åˆ†ç±»ä¸è®°å½•

**è¯´æ˜**: æ­¤é¡µé¢å®Œå…¨å‚ç…§"æ”¯å‡ºç®¡ç†-åˆ†ç±»ä¸è®°å½•"çš„å¸ƒå±€è®¾è®¡ï¼ˆè¯¦è§ç¬¬3.1èŠ‚ï¼‰ï¼Œä»¥ä¸‹æ˜¯ç®€åŒ–ç‰ˆwireframeã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æŠ•èµ„ç®¡ç† - åˆ†ç±»ä¸è®°å½•              [é€‰æ‹©å®¶åº­: Family 1 â–¼]  â”‚
â”‚  ç®¡ç†æŠ•èµ„è´¦æˆ·ï¼ŒæŒ‰å¤§ç±»æŸ¥çœ‹æŠ•èµ„è¶‹åŠ¿å’Œäº¤æ˜“è®°å½•                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“ˆ è‚¡ç¥¨æŠ•èµ„  â”‚  ğŸ¦ é€€ä¼‘åŸºé‡‘  â”‚  ğŸ’ æ•°å­—è´§å¸    â† å¤§ç±»Tab    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è´¦æˆ·åˆ—è¡¨â”‚  è´¦æˆ·è¯¦æƒ…                                          â”‚
â”‚ (3åˆ—)  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         â”‚  ğŸ“ˆ è‚¡ç¥¨æŠ•èµ„ - Fidelity 401k      [+ æ·»åŠ äº¤æ˜“]    â”‚
â”‚ Fidelityâ”‚  æŒæœ‰äºº: å¼ ä¸‰ | å¸ç§: USD                         â”‚
â”‚ 401k    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ $152.5K â”‚  æŠ•èµ„è¶‹åŠ¿       â”‚  äº¤æ˜“å†å²                       â”‚
â”‚ 12æ¡è®°å½•â”‚  [6æœˆ][1å¹´]...  â”‚  æœŸé—´  â”‚ç±»å‹â”‚é‡‘é¢    â”‚æ“ä½œ     â”‚
â”‚         â”‚                 â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€   â”‚
â”‚ Charles â”‚  [æŠ˜çº¿å›¾        â”‚ 2024-01â”‚æŠ•å…¥â”‚ $2,500â”‚ç¼–è¾‘ åˆ é™¤â”‚
â”‚ Schwab  â”‚   +æŸ±çŠ¶å›¾]      â”‚ 2024-02â”‚æŠ•å…¥â”‚ $2,500â”‚ç¼–è¾‘ åˆ é™¤â”‚
â”‚ $85.2K  â”‚                 â”‚ 2024-03â”‚å–å‡ºâ”‚ $1,000â”‚ç¼–è¾‘ åˆ é™¤â”‚
â”‚         â”‚                 â”‚                                 â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€ â”‚                 â”‚                                 â”‚
â”‚ æ€»è®¡    â”‚                 â”‚                                 â”‚
â”‚ $250.5K â”‚                 â”‚                                 â”‚
â”‚ 3ä¸ªè´¦æˆ· â”‚                 â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®ç‰¹å¾**:
- **æ¨ªå‘å¤§ç±»Tab**: é¡¶éƒ¨æ¨ªå‘æ˜¾ç¤ºæŠ•èµ„å¤§ç±»ï¼Œç‚¹å‡»åˆ‡æ¢
- **ä¸‰åˆ—å¸ƒå±€**: å·¦ä¾§è´¦æˆ·åˆ—è¡¨(3åˆ—) + å³ä¾§è¯¦æƒ…åŒº(9åˆ—)
- **è´¦æˆ·åˆ—è¡¨**: æ˜¾ç¤ºè´¦æˆ·åç§°ã€æœ€æ–°æ€»å€¼ã€è®°å½•æ•°ï¼Œæ— æ·»åŠ æŒ‰é’®
- **è¯¦æƒ…åŒº**: è´¦æˆ·ä¿¡æ¯å¡ç‰‡ + ä¸¤åˆ—ç­‰å®½å¸ƒå±€ï¼ˆè¶‹åŠ¿å›¾ + äº¤æ˜“åˆ—è¡¨ï¼‰
- **æœªé€‰ä¸­æ—¶**: æ˜¾ç¤º"è¯·é€‰æ‹©æŠ•èµ„è´¦æˆ·"æç¤º

### 6.2 ç®¡ç†-æŠ•èµ„ç®¡ç†-æ‰¹é‡å½•å…¥

**è¯´æ˜**: æ­¤é¡µé¢å®Œå…¨å‚ç…§"æ”¯å‡ºç®¡ç†-æ‰¹é‡å½•å…¥"çš„å¸ƒå±€è®¾è®¡ï¼ˆè¯¦è§ç¬¬3.2èŠ‚ï¼‰ï¼Œä»¥ä¸‹æ˜¯ç®€åŒ–ç‰ˆwireframeã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ‰¹é‡å½•å…¥æŠ•èµ„äº¤æ˜“                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [å®¶åº­: Family 1 â–¼]  [æœˆä»½: 2024-02]        [ä¿å­˜å…¨éƒ¨]      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è´¦æˆ·            â”‚ 11æœˆ  â”‚ 12æœˆ  â”‚ 01æœˆ  â”‚ 2024å¹´02æœˆ       â”‚
â”‚                  â”‚(æŠ•å…¥) â”‚(æŠ•å…¥) â”‚(æŠ•å…¥) â”‚ æŠ•å…¥   â”‚ å–å‡º   â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ ğŸ“ˆ Fidelity 401k â”‚ $2.5K â”‚ $2.5K â”‚ $2.5K â”‚[$2500] â”‚[$   0] â”‚
â”‚ ğŸ“ˆ Charles       â”‚ $1.0K â”‚ $1.0K â”‚ $1.0K â”‚[$1000] â”‚[$   0] â”‚
â”‚ ğŸ¦ Vanguard IRA  â”‚ $1.5K â”‚ $1.5K â”‚ $1.5K â”‚[$1500] â”‚[$   0] â”‚
â”‚ ğŸ’ Coinbase      â”‚   $0  â”‚   $0  â”‚ $500  â”‚[$   0] â”‚[$ 500] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æœ¬æœˆæ€»æŠ•å…¥: $5,000   æœ¬æœˆæ€»å–å‡º: $500   å‡€æŠ•å…¥: $4,500     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®ç‰¹å¾**:
- **æ¨ªå‘æ»šåŠ¨è¡¨æ ¼**: å‰3æœˆå†å² + æœ¬æœˆæŠ•å…¥/å–å‡ºåŒåˆ—è¾“å…¥
- **å†å²å‚è€ƒ**: åªæ˜¾ç¤ºå‰3æœˆæŠ•å…¥é‡‘é¢ï¼Œå¸®åŠ©ç”¨æˆ·äº†è§£å®šæŠ•è¶‹åŠ¿
- **åŒè¾“å…¥æ¡†**: æ¯ä¸ªè´¦æˆ·æœ‰æŠ•å…¥å’Œå–å‡ºä¸¤ä¸ªè¾“å…¥æ¡†
- **åº•éƒ¨ç»Ÿè®¡**: æ˜¾ç¤ºæ€»æŠ•å…¥ã€æ€»å–å‡ºã€å‡€æŠ•å…¥ä¸‰é¡¹æ±‡æ€»
- **å¤šå¸ç§**: æ¯ä¸ªè´¦æˆ·æ˜¾ç¤ºè‡ªå·±çš„å¸ç§ç¬¦å·

### 6.3 åˆ†æ-æŠ•èµ„åˆ†æ-å¹´åº¦æŠ•èµ„

**è¯´æ˜**: æ­¤é¡µé¢å®Œå…¨å‚ç…§"åˆ†æ-æ”¯å‡ºåˆ†æ-å¹´åº¦æ”¯å‡º"ï¼ˆExpenseAnnual.vueï¼‰çš„å¸ƒå±€è®¾è®¡ï¼ˆè¯¦è§ç¬¬3.3èŠ‚ï¼‰ï¼Œä»¥ä¸‹æ˜¯ç®€åŒ–ç‰ˆwireframeã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¹´åº¦æŠ•èµ„åˆ†æ                [å®¶åº­â–¼] [å¹´ä»½â–¼] [å¸ç§â–¼]         â”‚
â”‚  åˆ†æå¹´åº¦æŠ•èµ„ç»“æ„å’Œå‡€æŠ•å…¥æƒ…å†µ                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ å¤§ç±»åˆ†å¸ƒ (å·¦ä¾§, è·¨2è¡Œ) â”‚  â”‚ ğŸ“ˆè‚¡ç¥¨æŠ•èµ„ - è´¦æˆ·åˆ†å¸ƒ   â”‚   â”‚
â”‚  â”‚                       â”‚  â”‚ (å³ä¸Š)                   â”‚   â”‚
â”‚  â”‚ [å¤§ç±»é¥¼å›¾]            â”‚  â”‚ [é¥¼å›¾] â”‚ [è´¦æˆ·è¡¨æ ¼]     â”‚   â”‚
â”‚  â”‚                       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”‚                       â”‚                                 â”‚
â”‚  â”‚ [å¤§ç±»è¡¨æ ¼]            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ åˆ†ç±» â”‚å‡€æŠ•å…¥â”‚å æ¯”    â”‚  â”‚ Fidelity 401k - æœˆåº¦è¶‹åŠ¿â”‚   â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€    â”‚  â”‚ (å³ä¸‹)                   â”‚   â”‚
â”‚  â”‚ ğŸ“ˆè‚¡ç¥¨â”‚$XX   â”‚60% â—„ç‚¹å‡»â”‚  â”‚                         â”‚   â”‚
â”‚  â”‚ ğŸ¦é€€ä¼‘â”‚$XX   â”‚32%     â”‚  â”‚ [æŸ±çŠ¶å›¾: æŠ•å…¥/å–å‡º]     â”‚   â”‚
â”‚  â”‚ ğŸ’æ•°å­—â”‚$XX   â”‚8%      â”‚  â”‚  ç»¿æŸ±-æŠ•å…¥ çº¢æŸ±-å–å‡º    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®ç‰¹å¾**:
- **Gridå¸ƒå±€**: å·¦ä¾§å¤§ç±»åŒºåŸŸï¼ˆcol-span-6, row-span-2ï¼‰ï¼Œå³ä¾§ä¸Šä¸‹ä¸¤ä¸ªåŒºåŸŸï¼ˆå„col-span-6ï¼‰
- **å·¦ä¾§**: å¤§ç±»é¥¼å›¾ + å¤§ç±»è¡¨æ ¼ï¼ˆæ˜¾ç¤ºå‡€æŠ•å…¥å’Œå æ¯”ï¼‰
- **å³ä¸Š**: è´¦æˆ·é¥¼å›¾ + è´¦æˆ·è¡¨æ ¼ï¼ˆç‚¹å‡»å¤§ç±»åæ˜¾ç¤ºï¼Œæ¨ªå‘æ’åˆ—ï¼‰
- **å³ä¸‹**: æœˆåº¦è¶‹åŠ¿åŒæŸ±çŠ¶å›¾ï¼ˆç‚¹å‡»è´¦æˆ·åæ˜¾ç¤ºï¼Œç»¿è‰²æŠ•å…¥ + çº¢è‰²å–å‡ºï¼‰
- **æ•°æ®æŒ‡æ ‡**: å‡€æŠ•å…¥ = æŠ•å…¥æ€»é¢ - å–å‡ºæ€»é¢

## 7. å¼€å‘ä»»åŠ¡æ‹†åˆ†

### 7.1 æ•°æ®åº“è¿ç§»
- [ ] åˆ›å»ºæ•°æ®åº“è¿ç§»æ–‡ä»¶ï¼šV007__create_investment_management.sql
- [ ] ä¿®æ”¹asset_categoriesè¡¨ï¼Œæ·»åŠ is_investmentå­—æ®µ
- [ ] æ›´æ–°ç°æœ‰æ•°æ®ï¼Œæ ‡è®°æŠ•èµ„ç±»èµ„äº§
- [ ] åˆ›å»ºinvestment_transactionsè¡¨

### 7.2 åç«¯å¼€å‘
- [ ] åˆ›å»ºModel: InvestmentTransaction.java
- [ ] åˆ›å»ºRepository: InvestmentTransactionRepository.java
- [ ] åˆ›å»ºDTO:
  - InvestmentTransactionDTO.java
  - InvestmentAccountDTO.java
  - InvestmentAnnualSummaryDTO.java
  - InvestmentCategoryAnalysisDTO.java
  - InvestmentAccountAnalysisDTO.java
  - InvestmentMonthlyTrendDTO.java
- [ ] åˆ›å»ºService:
  - InvestmentTransactionService.java
  - InvestmentAnalysisService.java
- [ ] åˆ›å»ºController:
  - InvestmentTransactionController.java
  - InvestmentAnalysisController.java

### 7.3 å‰ç«¯å¼€å‘
- [ ] åˆ›å»ºAPIæ¨¡å—: src/api/investment.js
- [ ] åˆ›å»ºæŠ•èµ„ç®¡ç†é¡µé¢:
  - src/views/investments/InvestmentRecords.vueï¼ˆåˆ†ç±»ä¸è®°å½•ï¼‰
  - src/views/investments/InvestmentBatchEntry.vueï¼ˆæ‰¹é‡å½•å…¥ï¼‰
- [ ] åˆ›å»ºæŠ•èµ„åˆ†æé¡µé¢:
  - src/views/analysis/InvestmentAnalysis.vueï¼ˆå¹´åº¦æŠ•èµ„åˆ†æï¼‰
- [ ] æ›´æ–°è·¯ç”±é…ç½®: src/router/index.js
- [ ] æ›´æ–°ä¾§è¾¹æ å¯¼èˆª: src/components/Sidebar.vue

### 7.4 æµ‹è¯•
- [ ] åˆ›å»ºæµ‹è¯•æ•°æ®è„šæœ¬
- [ ] å•å…ƒæµ‹è¯•
- [ ] é›†æˆæµ‹è¯•
- [ ] UIæµ‹è¯•

## 8. æ³¨æ„äº‹é¡¹

1. **æ•°æ®ä¸€è‡´æ€§**:
   - æŠ•èµ„äº¤æ˜“è®°å½•ä¸èµ„äº§è®°å½•è¦ä¿æŒä¸€è‡´
   - åˆ é™¤èµ„äº§è´¦æˆ·æ—¶ï¼Œçº§è”åˆ é™¤ç›¸å…³æŠ•èµ„äº¤æ˜“è®°å½•

2. **æ€§èƒ½ä¼˜åŒ–**:
   - æŠ•èµ„åˆ†æå¯èƒ½æ¶‰åŠå¤§é‡è®¡ç®—ï¼Œè€ƒè™‘ç¼“å­˜ç­–ç•¥
   - æ‰¹é‡æ“ä½œä½¿ç”¨äº‹åŠ¡ç¡®ä¿åŸå­æ€§

3. **æ‰©å±•æ€§**:
   - é¢„ç•™å­—æ®µæ”¯æŒæœªæ¥åŠŸèƒ½ï¼ˆå¦‚è‚¡ç¥¨ä»£ç ã€äº¤æ˜“æ‰‹ç»­è´¹ç­‰ï¼‰
   - ä¿æŒä¸ç°æœ‰æ”¯å‡ºç®¡ç†æ¨¡å—çš„è®¾è®¡ä¸€è‡´æ€§

4. **ç”¨æˆ·ä½“éªŒ**:
   - æ‰¹é‡å½•å…¥é¡µé¢è‡ªåŠ¨åŠ è½½ç°æœ‰è®°å½•ï¼Œæ–¹ä¾¿ä¿®æ”¹
   - æŠ•èµ„åˆ†ææä¾›å¤šç»´åº¦è§†å›¾ï¼Œæ”¯æŒé’»å–
   - å›¾è¡¨äº¤äº’å‹å¥½ï¼Œæ”¯æŒå¯¼å‡ºæ•°æ®

5. **å®‰å…¨æ€§**:
   - æŠ•èµ„äº¤æ˜“è®°å½•æŒ‰å®¶åº­éš”ç¦»
   - APIæƒé™éªŒè¯ç¡®ä¿æ•°æ®å®‰å…¨

## 9. åç»­æ‰©å±•åŠŸèƒ½ï¼ˆå¯é€‰ï¼‰

ä»¥ä¸‹åŠŸèƒ½å¯åœ¨åŸºç¡€åŠŸèƒ½å®Œæˆåè€ƒè™‘ï¼š

1. **æŒä»“æ˜ç»†**:
   - è®°å½•å…·ä½“è‚¡ç¥¨ä»£ç ã€ä»½é¢ã€æˆæœ¬ä»·
   - æ”¯æŒåˆ†çº¢ã€æ‹†è‚¡ç­‰æ“ä½œ

2. **æŠ•èµ„ç»„åˆåˆ†æ**:
   - èµ„äº§é…ç½®å»ºè®®
   - é£é™©è¯„ä¼°
   - å†å¹³è¡¡æé†’

3. **å¯¹æ¯”åˆ†æ**:
   - ä¸å¸‚åœºåŸºå‡†å¯¹æ¯”ï¼ˆå¦‚S&P 500ï¼‰
   - å¹´åº¦å¯¹æ¯”ã€è´¦æˆ·å¯¹æ¯”

4. **å®šæŠ•è®¡åˆ’**:
   - è®¾ç½®å®šæŠ•è®¡åˆ’
   - è‡ªåŠ¨æé†’å½•å…¥

5. **ç¨åŠ¡æ”¯æŒ**:
   - èµ„æœ¬åˆ©å¾—è®¡ç®—
   - ç¨åŠ¡æŠ¥è¡¨ç”Ÿæˆ
