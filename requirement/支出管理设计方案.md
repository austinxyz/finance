# æ”¯å‡ºç®¡ç†è®¾è®¡æ–¹æ¡ˆ

**ç‰ˆæœ¬**: v1.0  
**æ—¥æœŸ**: 2024-12-10  
**ä¾æ®**: æ”¯å‡ºç®¡ç†éœ€æ±‚æ–‡æ¡£ v1.0

---

## ç›®å½•

1. [æ•°æ®åº“è®¾è®¡](#ä¸€æ•°æ®åº“è®¾è®¡)
2. [APIæ¥å£è®¾è®¡](#äºŒapiæ¥å£è®¾è®¡)
3. [å‰ç«¯ç»„ä»¶è®¾è®¡](#ä¸‰å‰ç«¯ç»„ä»¶è®¾è®¡)
4. [æŠ€æœ¯å®ç°è¦ç‚¹](#å››æŠ€æœ¯å®ç°è¦ç‚¹)
5. [å®æ–½è®¡åˆ’](#äº”å®æ–½è®¡åˆ’)

---

## ä¸€ã€æ•°æ®åº“è®¾è®¡

### 1.1 è¡¨ç»“æ„è®¾è®¡

#### 1.1.1 æ”¯å‡ºå¤§ç±»è¡¨ (expense_categories_major)

```sql
CREATE TABLE expense_categories_major (
  id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
  code VARCHAR(50) NOT NULL UNIQUE COMMENT 'å¤§ç±»ç¼–ç ï¼ˆCHILDREN, CLOTHINGç­‰ï¼‰',
  name VARCHAR(50) NOT NULL COMMENT 'å¤§ç±»åç§°',
  icon VARCHAR(50) COMMENT 'å›¾æ ‡ï¼ˆemojiæˆ–å›¾æ ‡ç±»åï¼‰',
  color VARCHAR(20) COMMENT 'é¢œè‰²ä»£ç ',
  sort_order INT NOT NULL DEFAULT 0 COMMENT 'æ’åºé¡ºåº',
  is_active BOOLEAN NOT NULL DEFAULT TRUE COMMENT 'æ˜¯å¦å¯ç”¨',
  description TEXT COMMENT 'è¯´æ˜',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',

  KEY idx_is_active (is_active),
  KEY idx_sort_order (sort_order)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ”¯å‡ºå¤§ç±»è¡¨';

-- åˆå§‹æ•°æ®
INSERT INTO expense_categories_major
  (code, name, icon, color, sort_order)
VALUES
  ('CHILDREN', 'å­å¥³', 'ğŸ‘¶', '#FF6B6B', 1),
  ('CLOTHING', 'è¡£', 'ğŸ‘”', '#4ECDC4', 2),
  ('FOOD', 'é£Ÿ', 'ğŸœ', '#95E1D3', 3),
  ('HOUSING', 'ä½', 'ğŸ ', '#F38181', 4),
  ('TRANSPORTATION', 'è¡Œ', 'ğŸš—', '#AA96DA', 5),
  ('INSURANCE', 'ä¿é™©', 'ğŸ›¡ï¸', '#FCBAD3', 6),
  ('SOCIAL', 'äººæƒ…', 'ğŸ', '#FFFFD2', 7),
  ('ENTERTAINMENT', 'å¨±ä¹', 'ğŸ®', '#A8D8EA', 8),
  ('BUSINESS', 'ç»è¥', 'ğŸ’¼', '#FFB6B9', 9),
  ('OTHER', 'å…¶ä»–', 'ğŸ“¦', '#C7CEEA', 10);
```

#### 1.1.2 æ”¯å‡ºå­åˆ†ç±»è¡¨ (expense_categories_minor)

```sql
CREATE TABLE expense_categories_minor (
  id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
  major_category_id BIGINT NOT NULL COMMENT 'æ‰€å±å¤§ç±»ID',
  name VARCHAR(100) NOT NULL COMMENT 'å­åˆ†ç±»åç§°',
  is_active BOOLEAN NOT NULL DEFAULT TRUE COMMENT 'æ˜¯å¦å¯ç”¨',
  is_default BOOLEAN NOT NULL DEFAULT FALSE COMMENT 'æ˜¯å¦ç³»ç»Ÿé»˜è®¤åˆ†ç±»',
  sort_order INT NOT NULL DEFAULT 0 COMMENT 'æ’åºé¡ºåº',
  description TEXT COMMENT 'è¯´æ˜',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',

  FOREIGN KEY (major_category_id) REFERENCES expense_categories_major(id),
  UNIQUE KEY uk_major_name (major_category_id, name),
  KEY idx_is_active (is_active),
  KEY idx_major_category (major_category_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ”¯å‡ºå­åˆ†ç±»è¡¨';
```

#### 1.1.3 æ”¯å‡ºè®°å½•è¡¨ (expense_records)

```sql
CREATE TABLE expense_records (
  id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
  family_id BIGINT NOT NULL COMMENT 'å®¶åº­ID',
  user_id BIGINT NOT NULL COMMENT 'è®°å½•äººID',

  -- æœŸé—´ä¸åˆ†ç±»
  expense_year INT NOT NULL COMMENT 'æ”¯å‡ºå¹´ä»½',
  expense_month INT NOT NULL COMMENT 'æ”¯å‡ºæœˆä»½',
  expense_period VARCHAR(7) NOT NULL COMMENT 'æ”¯å‡ºæœŸé—´ï¼ˆYYYY-MMï¼‰',
  major_category_id BIGINT NOT NULL COMMENT 'å¤§ç±»ID',
  minor_category_id BIGINT NOT NULL COMMENT 'å­åˆ†ç±»ID',

  -- é‡‘é¢
  amount DECIMAL(18, 2) NOT NULL COMMENT 'æ”¯å‡ºé‡‘é¢',
  currency VARCHAR(10) NOT NULL DEFAULT 'CNY' COMMENT 'è´§å¸ä»£ç ',
  amount_in_base_currency DECIMAL(18, 2) COMMENT 'åŸºå‡†è´§å¸é‡‘é¢ï¼ˆåç«¯è®¡ç®—ï¼‰',

  -- ç±»å‹ä¸è¯´æ˜
  expense_type VARCHAR(20) NOT NULL COMMENT 'æ”¯å‡ºç±»å‹ï¼ˆFIXED_DAILY/LARGE_IRREGULARï¼‰',
  description TEXT COMMENT 'è¯´æ˜',

  -- å®¡è®¡å­—æ®µ
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',

  FOREIGN KEY (family_id) REFERENCES families(id),
  FOREIGN KEY (user_id) REFERENCES users(id),
  FOREIGN KEY (major_category_id) REFERENCES expense_categories_major(id),
  FOREIGN KEY (minor_category_id) REFERENCES expense_categories_minor(id),

  UNIQUE KEY uk_period_category (family_id, expense_period, minor_category_id),
  KEY idx_family_period (family_id, expense_year, expense_month),
  KEY idx_expense_period (expense_period),
  KEY idx_major_category (major_category_id),
  KEY idx_minor_category (minor_category_id),
  KEY idx_expense_type (expense_type),
  KEY idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ”¯å‡ºè®°å½•è¡¨';
```

**çº¦æŸè¯´æ˜**ï¼š
- `uk_period_category`ï¼šåŒä¸€å®¶åº­ã€åŒä¸€æœŸé—´ã€åŒä¸€åˆ†ç±»åªèƒ½æœ‰ä¸€æ¡è®°å½•ï¼ˆæœˆåº¦æ±‡æ€»ç‰¹æ€§ï¼‰
- é‡‘é¢å­—æ®µä½¿ç”¨ DECIMAL(18,2) ä¿è¯ç²¾åº¦
- expense_period å†—ä½™å­—æ®µæ–¹ä¾¿æŸ¥è¯¢
- amount_in_base_currency åç«¯æ ¹æ® expense_period + currency ä»æ±‡ç‡è¡¨æŸ¥è¯¢æ±‡ç‡åè®¡ç®—å¹¶å­˜å‚¨

#### 1.1.4 è‰ç¨¿åŠŸèƒ½ï¼ˆå‰ç«¯å®ç°ï¼‰

> **è®¾è®¡å†³ç­–**ï¼šè‰ç¨¿åŠŸèƒ½æ”¹ç”±å‰ç«¯ `localStorage/sessionStorage` å®ç°ï¼Œæ— éœ€æ•°æ®åº“è¡¨ã€‚
>
> **ä¼˜åŠ¿**ï¼š
> - å‡å°‘æ•°æ®åº“è´Ÿæ‹…
> - æ›´å¿«çš„å“åº”é€Ÿåº¦
> - ç¦»çº¿ä¹Ÿå¯ä¿å­˜è‰ç¨¿
> - å‰ç«¯å®Œå…¨æ§åˆ¶è‰ç¨¿ç”Ÿå‘½å‘¨æœŸ

**localStorage æ•°æ®ç»“æ„ç¤ºä¾‹**ï¼š
```json
{
  "expense_draft_2025-11": {
    "period": "2025-11",
    "records": [
      {
        "minorCategoryId": 22,
        "amount": 3500.00,
        "currency": "CNY",
        "expenseType": "FIXED_DAILY",
        "description": "æˆ¿ç§Ÿ"
      }
    ],
    "lastModified": "2025-12-10T15:30:00"
  }
}
```

### 1.2 ç´¢å¼•ç­–ç•¥

| æŸ¥è¯¢åœºæ™¯ | ä½¿ç”¨ç´¢å¼• | è¯´æ˜ |
|---------|---------|------|
| æŸæœˆæ”¯å‡ºåˆ—è¡¨ | idx_family_period | è¦†ç›– family_id + year + month |
| æŸåˆ†ç±»å†å² | idx_minor_category | å¿«é€Ÿå®šä½åˆ†ç±» |
| æ—¶é—´èŒƒå›´æŸ¥è¯¢ | idx_expense_period | å­—ç¬¦ä¸²æ¯”è¾ƒæ•ˆç‡é«˜ |
| å›ºå®š/å¤§é¢ç­›é€‰ | idx_expense_type | å¿«é€Ÿè¿‡æ»¤ç±»å‹ |
| æœ€æ–°è®°å½• | idx_created_at | æŒ‰æ—¶é—´é™åºæŸ¥è¯¢ |

---

## äºŒã€APIæ¥å£è®¾è®¡

### 2.1 RESTful API è§„èŒƒ

**åŸºç¡€è·¯å¾„**: `/api/expense`  
**è®¤è¯**: ä½¿ç”¨ç°æœ‰ç³»ç»Ÿçš„JWTè®¤è¯  
**å“åº”æ ¼å¼**: ç»Ÿä¸€JSONæ ¼å¼

```json
{
  "success": true|false,
  "message": "æ“ä½œæè¿°",
  "data": {}
}
```

### 2.2 åˆ†ç±»ç®¡ç†æ¥å£

#### 2.2.1 è·å–å¤§ç±»åˆ—è¡¨

```
GET /api/expense-categories/major

Response:
{
  "success": true,
  "data": [
    {
      "id": 1,
      "code": "CHILDREN",
      "name": "å­å¥³",
      "icon": "ğŸ‘¶",
      "color": "#FF6B6B",
      "sortOrder": 1,
      "isActive": true
    }
  ]
}
```

#### 2.2.2 è·å–å­åˆ†ç±»åˆ—è¡¨ï¼ˆæ ‘å½¢ç»“æ„ï¼‰

```
GET /api/expense-categories/minor/tree

Response:
{
  "success": true,
  "data": [
    {
      "majorCategory": {
        "id": 1,
        "code": "CHILDREN",
        "name": "å­å¥³",
        "icon": "ğŸ‘¶"
      },
      "minorCategories": [
        {
          "id": 1,
          "name": "å­¦è´¹",
          "isActive": true,
          "recordCount": 12,
          "latestAmount": 3500.00
        }
      ]
    }
  ]
}
```

#### 2.2.3 æ–°å¢å­åˆ†ç±»

```
POST /api/expense-categories/minor

Request:
{
  "majorCategoryId": 1,
  "name": "å…´è¶£ç­",
  "description": "é’¢ç´ã€ç»˜ç”»ç­‰"
}

Response:
{
  "success": true,
  "message": "å­åˆ†ç±»åˆ›å»ºæˆåŠŸ",
  "data": { "id": 15 }
}
```

#### 2.2.4 æ›´æ–°å­åˆ†ç±»

```
PUT /api/expense-categories/minor/{id}

Request:
{
  "name": "è¯¾å¤–è¾…å¯¼",
  "description": "æ•°å­¦ã€è‹±è¯­ç­‰",
  "isActive": false
}
```

#### 2.2.5 åˆ é™¤å­åˆ†ç±»

```
DELETE /api/expense-categories/minor/{id}

Response (å¤±è´¥ - æœ‰å…³è”è®°å½•):
{
  "success": false,
  "message": "è¯¥åˆ†ç±»ä¸‹æœ‰12æ¡æ”¯å‡ºè®°å½•ï¼Œæ— æ³•åˆ é™¤ã€‚è¯·å…ˆåœç”¨è¯¥åˆ†ç±»ã€‚"
}
```

### 2.3 æ”¯å‡ºè®°å½•æ¥å£

#### 2.3.1 æ‰¹é‡ä¿å­˜/æ›´æ–°æŸæœˆæ”¯å‡º

```
POST /api/expense-records/batch

Request:
{
  "familyId": 1,
  "expensePeriod": "2025-11",
  "records": [
    {
      "minorCategoryId": 1,
      "amount": 3500.00,
      "currency": "CNY",
      "expenseType": "FIXED_DAILY",
      "description": "å°å­¦å­¦è´¹"
    }
  ]
}

Response:
{
  "success": true,
  "data": {
    "savedCount": 15,
    "totalAmount": 15230.00,
    "fixedAmount": 12500.00,
    "largeAmount": 2730.00
  }
}
```

**åç«¯å¤„ç†é€»è¾‘**ï¼š
1. å…ˆåˆ é™¤è¯¥æœŸé—´è¯¥å®¶åº­çš„æ‰€æœ‰è®°å½•ï¼ˆæˆ–åŸºäº uk_period_category çº¦æŸç›´æ¥ UPSERTï¼‰
2. æ‰¹é‡æ’å…¥æ–°è®°å½•ï¼ˆé‡‘é¢ > 0 çš„ï¼‰
3. å¯¹æ¯æ¡è®°å½•ï¼š
   - æ ¹æ® expensePeriod + currency ä» exchange_rates è¡¨æŸ¥è¯¢æ±‡ç‡
   - è®¡ç®— amount_in_base_currency = amount Ã— rate_to_usd Ã— usd_to_cny_rate
   - å­˜å‚¨å®Œæ•´è®°å½•
4. è¿”å›ç»Ÿè®¡ä¿¡æ¯

#### 2.3.2 æŸ¥è¯¢æŸæœˆæ”¯å‡ºè®°å½•

```
GET /api/expense-records/period?familyId=1&period=2025-11

Response:
{
  "success": true,
  "data": {
    "period": "2025-11",
    "records": [...],
    "summary": {
      "totalAmount": 15230.00,
      "fixedAmount": 12500.00,
      "largeAmount": 2730.00
    }
  }
}
```

#### 2.3.3 æ·»åŠ å•æ¡è®°å½•

```
POST /api/expense-records

Request:
{
  "familyId": 1,
  "expensePeriod": "2025-11",
  "minorCategoryId": 1,
  "amount": 3500.00,
  "currency": "CNY",
  "expenseType": "FIXED_DAILY",
  "description": "å°å­¦å­¦è´¹"
}
```

#### 2.3.4 æ›´æ–°å•æ¡è®°å½•

```
PUT /api/expense-records/{id}

Request:
{
  "amount": 3600.00,
  "expenseType": "FIXED_DAILY",
  "description": "å°å­¦ç§‹å­£å­¦è´¹+åˆé¤è´¹"
}
```

#### 2.3.5 åˆ é™¤å•æ¡è®°å½•

```
DELETE /api/expense-records/{id}
```

#### 2.3.6 å¤åˆ¶ä¸Šæœˆæ”¯å‡º

```
POST /api/expense-records/copy-from-last-month

Request:
{
  "familyId": 1,
  "targetPeriod": "2025-12"
}

Response:
{
  "success": true,
  "message": "å·²å¤åˆ¶2025-11çš„æ”¯å‡ºè®°å½•",
  "data": {
    "sourcePeriod": "2025-11",
    "copiedCount": 15,
    "records": [...]
  }
}
```

#### 2.3.7 æŸ¥è¯¢åˆ†ç±»å†å²è®°å½•ï¼ˆç”¨äºè¶‹åŠ¿å›¾ï¼‰

```
GET /api/expense-records/category-history

Query Parameters:
- familyId (å¿…å¡«)
- minorCategoryId (å¿…å¡«)
- startPeriod: å¼€å§‹æœŸé—´ï¼ˆYYYY-MMï¼‰
- endPeriod: ç»“æŸæœŸé—´ï¼ˆYYYY-MMï¼‰
- months: æœ€è¿‘Nä¸ªæœˆï¼ˆä¸startPeriod/endPeriodäºŒé€‰ä¸€ï¼‰

Response:
{
  "success": true,
  "data": {
    "categoryName": "å¤–å‡ºå°±é¤",
    "records": [
      {
        "period": "2025-01",
        "amount": 1650.00,
        "expenseType": "FIXED_DAILY"
      },
      {
        "period": "2025-02",
        "amount": 1700.00,
        "expenseType": "FIXED_DAILY"
      }
    ],
    "avgAmount": 1750.00,
    "maxAmount": 2100.00,
    "minAmount": 1500.00
  }
}
```

### 2.4 è‰ç¨¿æ¥å£

#### 2.4.1 ä¿å­˜è‰ç¨¿

```
POST /api/expense-drafts

Request:
{
  "familyId": 1,
  "expensePeriod": "2025-11",
  "draftData": { ... }
}
```

#### 2.4.2 è·å–è‰ç¨¿

```
GET /api/expense-drafts?familyId=1&period=2025-11

Response:
{
  "success": true,
  "data": {
    "id": 5,
    "draftData": { ... },
    "updatedAt": "2025-12-10T15:30:00"
  }
}
```

#### 2.4.3 åˆ é™¤è‰ç¨¿

```
DELETE /api/expense-drafts/{id}
```

### 2.5 ç»Ÿè®¡åˆ†ææ¥å£

#### 2.5.1 æœˆåº¦ç»Ÿè®¡

```
GET /api/expense-statistics/monthly?familyId=1&period=2025-11

Response:
{
  "success": true,
  "data": {
    "period": "2025-11",
    "totalAmount": 15230.00,
    "fixedAmount": 12500.00,
    "largeAmount": 2730.00,
    "fixedRatio": 0.82,
    "largeRatio": 0.18,
    "byMajorCategory": [
      {
        "majorCategoryName": "ä½",
        "amount": 8000.00,
        "ratio": 0.525
      }
    ]
  }
}
```

#### 2.5.2 æ—¶é—´èŒƒå›´è¶‹åŠ¿

```
GET /api/expense-statistics/trend

Query Parameters:
- familyId (å¿…å¡«)
- startPeriod (å¿…å¡«)
- endPeriod (å¿…å¡«)
- majorCategoryId (å¯é€‰)

Response:
{
  "success": true,
  "data": {
    "periods": ["2025-01", "2025-02", ...],
    "totalAmounts": [14200, 13800, ...],
    "avgAmount": 14580.00
  }
}
```

---

## ä¸‰ã€å‰ç«¯ç»„ä»¶è®¾è®¡

### 3.1 é¡µé¢ç»„ä»¶ç»“æ„

```
src/views/expense/
  â”œâ”€ ExpenseCategories.vue      # åˆ†ç±»ä¸è®°å½•é¡µé¢ï¼ˆå‚è€ƒAccountHistory.vueï¼‰
  â”œâ”€ ExpenseBatchUpdate.vue     # æ‰¹é‡å½•å…¥é¡µé¢ï¼ˆå‚è€ƒBatchUpdate.vueï¼‰
  â””â”€ components/
      â”œâ”€ CategoryDialog.vue      # æ·»åŠ /ç¼–è¾‘åˆ†ç±»å¯¹è¯æ¡†
      â”œâ”€ RecordDialog.vue        # æ·»åŠ /ç¼–è¾‘è®°å½•å¯¹è¯æ¡†
      â””â”€ ExpenseChart.vue        # è¶‹åŠ¿å›¾ç»„ä»¶
```

### 3.2 é¡µé¢1ï¼šåˆ†ç±»ä¸è®°å½•ï¼ˆExpenseCategories.vueï¼‰

**å‚è€ƒ**: AccountHistory.vueï¼ˆèµ„äº§ç®¡ç† - è´¦æˆ·ä¸è®°å½•ï¼‰

**å¸ƒå±€ç»“æ„**ï¼š
- Tabå¯¼èˆªï¼š9ä¸ªå›ºå®šå¤§ç±»ï¼ˆcol-span-12ï¼‰
- å·¦ä¾§ï¼šå­åˆ†ç±»åˆ—è¡¨ï¼ˆcol-span-3ï¼‰
- å³ä¾§ï¼šè¶‹åŠ¿å›¾ + è®°å½•åˆ—è¡¨ï¼ˆcol-span-9ï¼‰

**å…³é”®å®ç°ç‚¹**ï¼š

```vue
<script setup>
import { ref, computed, watch } from 'vue'
import { Chart } from 'chart.js/auto'
import 'chartjs-adapter-date-fns'
import expenseCategoryAPI from '@/api/expenseCategory'
import expenseRecordAPI from '@/api/expenseRecord'

// çŠ¶æ€ç®¡ç†
const majorCategories = ref([])
const selectedMajorCategory = ref(null)
const currentMinorCategories = ref([])
const selectedMinorCategory = ref(null)
const records = ref([])
const selectedTimeRange = ref('12m')

// åŠ è½½å¤§ç±»
const loadMajorCategories = async () => {
  const res = await expenseCategoryAPI.getMajorCategories()
  majorCategories.value = res.data
  if (majorCategories.value.length > 0) {
    selectedMajorCategory.value = majorCategories.value[0]
  }
}

// åŠ è½½å­åˆ†ç±»ï¼ˆå¸¦è®°å½•ç»Ÿè®¡ï¼‰
const loadMinorCategories = async () => {
  const res = await expenseCategoryAPI.getMinorCategoriesTree()
  const major = res.data.find(m => m.majorCategory.id === selectedMajorCategory.value.id)
  currentMinorCategories.value = major?.minorCategories || []
}

// åŠ è½½åˆ†ç±»å†å²è®°å½•
const loadCategoryHistory = async () => {
  if (!selectedMinorCategory.value) return
  
  const months = selectedTimeRange.value === '6m' ? 6 : 
                 selectedTimeRange.value === '12m' ? 12 : 
                 selectedTimeRange.value === '3y' ? 36 : 12
  
  const res = await expenseRecordAPI.getCategoryHistory({
    familyId: 1,
    minorCategoryId: selectedMinorCategory.value.id,
    months
  })
  
  records.value = res.data.records
  updateChart()
}

// æ›´æ–°è¶‹åŠ¿å›¾
const updateChart = () => {
  // Chart.js implementation (æ—¶é—´è½´ + æŠ˜çº¿å›¾/æŸ±çŠ¶å›¾)
}

// é€‰æ‹©åˆ†ç±»
const selectCategory = (category) => {
  selectedMinorCategory.value = category
  loadCategoryHistory()
}

// Watch major category change
watch(selectedMajorCategory, () => {
  loadMinorCategories()
  selectedMinorCategory.value = null
  records.value = []
})
</script>
```

**äº¤äº’è®¾è®¡**ï¼š
1. Tabé€‰ä¸­é«˜äº®ï¼š`border-primary text-primary`
2. å·¦ä¾§åˆ†ç±»hoverï¼š`opacity-0 â†’ opacity-100`ï¼ˆç¼–è¾‘/åœç”¨æŒ‰é’®ï¼‰
3. é€‰ä¸­åˆ†ç±»é«˜äº®ï¼š`bg-primary/10 border-l-4 border-primary`
4. è¶‹åŠ¿å›¾æ—¶é—´èŒƒå›´æŒ‰é’®ï¼š`bg-primary text-white` vs `bg-gray-100`

### 3.3 é¡µé¢2ï¼šæ‰¹é‡å½•å…¥ï¼ˆExpenseBatchUpdate.vueï¼‰

**å‚è€ƒ**: BatchUpdate.vueï¼ˆèµ„äº§ç®¡ç† - æ‰¹é‡æ›´æ–°ï¼‰

**å¸ƒå±€ç»“æ„**ï¼š
- å¤´éƒ¨ï¼šæœŸé—´é€‰æ‹© + å¤§ç±»ç­›é€‰ + å¤åˆ¶ä¸Šæœˆ + ä¿å­˜å…¨éƒ¨ï¼ˆgrid-cols-12ï¼‰
- åˆ—è¡¨ï¼šgrid-cols-12 è¡Œï¼ˆåˆ†ç±»3 + ä¸Šæœˆ2 + è¾“å…¥3 + ç±»å‹2 + å·®é¢2ï¼‰
- åº•éƒ¨ï¼šç»Ÿè®¡æ±‡æ€»ï¼ˆæ€»æ”¯å‡º + å›ºå®š + å¤§é¢ï¼‰

**å…³é”®å®ç°ç‚¹**ï¼š

```vue
<script setup>
import { ref, computed, watch } from 'vue'
import expenseRecordAPI from '@/api/expenseRecord'

// è¡¨å•æ•°æ®
const recordDate = ref('2025-11')
const selectedCategoryType = ref('all')
const expenseRecords = ref([]) // æ‰€æœ‰åˆ†ç±»
const changedRecords = new Set() // è¿½è¸ªå˜æ›´

// å¤åˆ¶ä¸Šæœˆ
const copyFromLastMonth = async () => {
  const res = await expenseRecordAPI.copyFromLastMonth({
    familyId: 1,
    targetPeriod: recordDate.value
  })
  expenseRecords.value = res.data.records
}

// åŠ è½½ä¸Šæœˆæ•°æ®ï¼ˆç”¨äºå¯¹æ¯”ï¼‰
const loadPreviousMonthData = async () => {
  const previous = getPreviousPeriod(recordDate.value)
  const res = await expenseRecordAPI.getByPeriod({
    familyId: 1,
    period: previous
  })
  
  // å°†ä¸Šæœˆæ•°æ®åˆå¹¶åˆ°å½“å‰
  expenseRecords.value.forEach(record => {
    const prev = res.data.records.find(r => r.minorCategoryId === record.minorCategoryId)
    record.previousAmount = prev?.amount || 0
    record.difference = record.amount - record.previousAmount
  })
}

// è¿½è¸ªå˜æ›´
const handleAmountChange = (record) => {
  record.difference = record.amount - record.previousAmount
  changedRecords.add(record.minorCategoryId)
}

// æ‰¹é‡ä¿å­˜
const saveAll = async () => {
  const res = await expenseRecordAPI.batchSave({
    familyId: 1,
    expensePeriod: recordDate.value,
    records: expenseRecords.value.filter(r => r.amount > 0)
  })
  // æ˜¾ç¤ºæˆåŠŸæç¤º
  changedRecords.clear()
}

// è®¡ç®—ç»Ÿè®¡
const summary = computed(() => {
  const total = expenseRecords.value.reduce((sum, r) => sum + (r.amount || 0), 0)
  const fixed = expenseRecords.value
    .filter(r => r.expenseType === 'FIXED_DAILY')
    .reduce((sum, r) => sum + (r.amount || 0), 0)
  const large = total - fixed
  
  return { total, fixed, large }
})

// Watch date change
watch(recordDate, () => {
  loadPreviousMonthData()
})
</script>
```

### 3.4 å¯¹è¯æ¡†ç»„ä»¶

#### 3.4.1 åˆ†ç±»å¯¹è¯æ¡†ï¼ˆCategoryDialog.vueï¼‰

```vue
<template>
  <div v-if="show" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-lg p-6 w-full max-w-md">
      <h2 class="text-xl font-bold mb-4">
        {{ mode === 'create' ? 'æ·»åŠ å­åˆ†ç±»' : 'ç¼–è¾‘å­åˆ†ç±»' }}
      </h2>
      <form @submit.prevent="handleSubmit" class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">æ‰€å±å¤§ç±»</label>
          <div class="w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-lg">
            {{ majorCategory.icon }} {{ majorCategory.name }}
          </div>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">å­åˆ†ç±»åç§° *</label>
          <input
            v-model="formData.name"
            type="text"
            required
            placeholder="ä¾‹å¦‚ï¼šå­¦è´¹"
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
          />
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">è¯´æ˜</label>
          <textarea
            v-model="formData.description"
            rows="3"
            class="w-full px-3 py-2 border border-gray-300 rounded-lg"
          ></textarea>
        </div>
        
        <div v-if="mode === 'edit'">
          <label class="flex items-center gap-2">
            <input v-model="formData.isActive" type="checkbox" class="w-4 h-4" />
            <span class="text-sm">å¯ç”¨è¯¥åˆ†ç±»</span>
          </label>
          <p v-if="category?.recordCount > 0" class="text-xs text-amber-600 mt-1">
            âš ï¸ è¯¥åˆ†ç±»å·²æœ‰ {{ category.recordCount }} æ¡æ”¯å‡ºè®°å½•
          </p>
        </div>
        
        <div class="flex gap-3 pt-2">
          <button
            v-if="mode === 'edit' && category?.recordCount === 0"
            type="button"
            @click="handleDelete"
            class="px-4 py-2 text-red-600 border border-red-600 rounded-lg hover:bg-red-50"
          >
            åˆ é™¤
          </button>
          <button
            type="button"
            @click="$emit('close')"
            class="flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50"
          >
            å–æ¶ˆ
          </button>
          <button
            type="submit"
            class="flex-1 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90"
          >
            {{ mode === 'create' ? 'æ·»åŠ ' : 'ä¿å­˜' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</template>

<script setup>
import { ref } from 'vue'

const props = defineProps({
  show: Boolean,
  mode: String, // 'create' | 'edit'
  majorCategory: Object,
  category: Object
})

const emit = defineEmits(['close', 'save', 'delete'])

const formData = ref({
  name: props.category?.name || '',
  description: props.category?.description || '',
  isActive: props.category?.isActive ?? true
})

const handleSubmit = () => {
  emit('save', formData.value)
}

const handleDelete = () => {
  if (confirm('ç¡®å®šåˆ é™¤è¯¥åˆ†ç±»å—ï¼Ÿ')) {
    emit('delete', props.category.id)
  }
}
</script>
```

#### 3.4.2 è®°å½•å¯¹è¯æ¡†ï¼ˆRecordDialog.vueï¼‰

```vue
<template>
  <div v-if="show" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-lg p-6 w-full max-w-md">
      <h2 class="text-xl font-bold mb-4">
        {{ mode === 'create' ? 'æ·»åŠ æ”¯å‡ºè®°å½•' : 'ç¼–è¾‘æ”¯å‡ºè®°å½•' }}
      </h2>
      <form @submit.prevent="handleSubmit" class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">åˆ†ç±»</label>
          <div class="w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-lg">
            {{ categoryFullName }}
          </div>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">æœŸé—´ *</label>
          <select
            v-model="formData.expensePeriod"
            required
            class="w-full px-3 py-2 border border-gray-300 rounded-lg"
          >
            <option v-for="period in availablePeriods" :key="period" :value="period">
              {{ period }}
            </option>
          </select>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">é‡‘é¢ *</label>
          <div class="relative">
            <span class="absolute left-3 top-2 text-gray-500">Â¥</span>
            <input
              v-model="formData.amount"
              type="number"
              step="0.01"
              min="0"
              required
              class="w-full pl-8 pr-3 py-2 border border-gray-300 rounded-lg"
            />
          </div>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">ç±»å‹ *</label>
          <div class="flex gap-4">
            <label class="flex items-center gap-2 cursor-pointer">
              <input
                v-model="formData.expenseType"
                type="radio"
                value="FIXED_DAILY"
                class="w-4 h-4"
              />
              <span class="text-sm">å›ºå®šæ—¥å¸¸</span>
            </label>
            <label class="flex items-center gap-2 cursor-pointer">
              <input
                v-model="formData.expenseType"
                type="radio"
                value="LARGE_IRREGULAR"
                class="w-4 h-4"
              />
              <span class="text-sm">å¤§é¢æ”¯å‡º</span>
            </label>
          </div>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">è¯´æ˜</label>
          <textarea
            v-model="formData.description"
            rows="3"
            maxlength="200"
            class="w-full px-3 py-2 border border-gray-300 rounded-lg"
          ></textarea>
          <p class="text-xs text-gray-500 mt-1">{{ formData.description?.length || 0 }}/200</p>
        </div>
        
        <div class="flex gap-3 pt-2">
          <button
            v-if="mode === 'edit'"
            type="button"
            @click="handleDelete"
            class="px-4 py-2 text-red-600 border border-red-600 rounded-lg hover:bg-red-50"
          >
            åˆ é™¤
          </button>
          <button
            type="button"
            @click="$emit('close')"
            class="flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50"
          >
            å–æ¶ˆ
          </button>
          <button
            type="submit"
            class="flex-1 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90"
          >
            {{ mode === 'create' ? 'æ·»åŠ ' : 'ä¿å­˜' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</template>

<script setup>
import { ref, computed } from 'vue'

const props = defineProps({
  show: Boolean,
  mode: String, // 'create' | 'edit'
  categoryFullName: String,
  record: Object
})

const emit = defineEmits(['close', 'save', 'delete'])

// ç”Ÿæˆå¯é€‰æœŸé—´åˆ—è¡¨ï¼ˆè¿‘24ä¸ªæœˆï¼‰
const availablePeriods = computed(() => {
  const periods = []
  const now = new Date()
  for (let i = 0; i < 24; i++) {
    const date = new Date(now.getFullYear(), now.getMonth() - i, 1)
    periods.push(`${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`)
  }
  return periods
})

const formData = ref({
  expensePeriod: props.record?.expensePeriod || availablePeriods.value[0],
  amount: props.record?.amount || null,
  expenseType: props.record?.expenseType || 'FIXED_DAILY',
  description: props.record?.description || ''
})

const handleSubmit = () => {
  emit('save', formData.value)
}

const handleDelete = () => {
  if (confirm('ç¡®å®šåˆ é™¤è¯¥è®°å½•å—ï¼Ÿ')) {
    emit('delete', props.record.id)
  }
}
</script>
```

---

## å››ã€æŠ€æœ¯å®ç°è¦ç‚¹

### 4.1 æŠ€æœ¯æ ˆ

**å‰ç«¯**ï¼š
- Vue 3 + Composition API
- Tailwind CSSï¼ˆä¸ç°æœ‰ç³»ç»Ÿä¸€è‡´ï¼‰
- Chart.js + chartjs-adapter-date-fns
- Axiosï¼ˆHTTPå®¢æˆ·ç«¯ï¼‰
- Viteï¼ˆæ„å»ºå·¥å…·ï¼‰

**åç«¯**ï¼š
- Spring Boot 3.2.0
- MyBatis Plus
- MySQL 8.0
- Redisï¼ˆå¯é€‰ï¼Œç”¨äºç¼“å­˜ï¼‰

### 4.2 æ€§èƒ½ä¼˜åŒ–

1. **åˆ†ç±»æ•°æ®ç¼“å­˜**ï¼š
   - å¤§ç±»ã€å­åˆ†ç±»ä¸å¸¸å˜åŒ–ï¼Œä½¿ç”¨Redisç¼“å­˜
   - ç¼“å­˜å¤±æ•ˆç­–ç•¥ï¼šåˆ†ç±»æ›´æ–°æ—¶æ¸…é™¤å¯¹åº”ç¼“å­˜

2. **åˆ†é¡µæŸ¥è¯¢ä¼˜åŒ–**ï¼š
   - å†å²è®°å½•åˆ—è¡¨ä½¿ç”¨åˆ†é¡µåŠ è½½
   - é»˜è®¤æ¯é¡µ20æ¡ï¼Œæ”¯æŒåˆ‡æ¢

3. **ç´¢å¼•ä¼˜åŒ–**ï¼š
   - uk_period_categoryï¼šä¿è¯æ•°æ®å”¯ä¸€æ€§
   - idx_family_periodï¼šä¼˜åŒ–æœˆåº¦æŸ¥è¯¢
   - idx_minor_categoryï¼šä¼˜åŒ–åˆ†ç±»å†å²æŸ¥è¯¢

4. **æ‰¹é‡æ“ä½œäº‹åŠ¡æ§åˆ¶**ï¼š
   - æ‰¹é‡ä¿å­˜ä½¿ç”¨äº‹åŠ¡
   - å¤±è´¥æ—¶å…¨éƒ¨å›æ»š

### 4.3 æ•°æ®ä¸€è‡´æ€§ä¿è¯

1. **æ±‡ç‡æŸ¥è¯¢**ï¼š
   - æ ¹æ®æ”¯å‡ºæœŸé—´ï¼ˆYYYY-MMï¼‰+ å¸ç§ä» exchange_rates è¡¨æŸ¥è¯¢å¯¹åº”æ±‡ç‡
   - ä¼˜å…ˆæŸ¥è¯¢å½“æœˆæœ€åä¸€å¤©çš„æ±‡ç‡ï¼Œè‹¥æ— åˆ™æŸ¥æœ€è¿‘çš„å†å²æ±‡ç‡
   - ç¤ºä¾‹ï¼š2025-11 çš„ USD æ”¯å‡º â†’ æŸ¥è¯¢ effective_date = '2025-11-30' æˆ–æœ€è¿‘çš„ USD æ±‡ç‡

2. **åŸºå‡†è´§å¸é¢„è®¡ç®—**ï¼š
   - amount_in_base_currency åç«¯è®¡ç®—å¹¶å­˜å‚¨
   - è®¡ç®—å…¬å¼ï¼šamount Ã— rate_to_usd Ã— usd_to_cny_rate
   - é¿å…æŸ¥è¯¢æ—¶é‡å¤è®¡ç®—ï¼Œæå‡æ€§èƒ½

3. **è½¯åˆ é™¤**ï¼š
   - åˆ†ç±»åœç”¨ï¼ˆisActive=falseï¼‰è€Œéåˆ é™¤
   - ä¿ç•™å†å²å¼•ç”¨å®Œæ•´æ€§

### 4.4 Chart.jsé…ç½®

```javascript
// æ—¶é—´è½´é…ç½®
import { Chart } from 'chart.js/auto'
import 'chartjs-adapter-date-fns'

const chartConfig = {
  type: 'line', // æˆ– 'bar'
  data: {
    datasets: [{
      label: 'æœˆåº¦æ”¯å‡º',
      data: records.map(r => ({
        x: `${r.period}-01`, // YYYY-MM-DDæ ¼å¼
        y: r.amount
      })),
      borderColor: '#4ECDC4',
      backgroundColor: 'rgba(78, 205, 196, 0.1)',
      tension: 0.3
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      x: {
        type: 'time',
        time: {
          unit: 'month',
          displayFormats: {
            month: 'yyyy-MM'
          }
        },
        title: {
          display: true,
          text: 'æœŸé—´'
        }
      },
      y: {
        beginAtZero: true,
        title: {
          display: true,
          text: 'é‡‘é¢ (Â¥)'
        }
      }
    },
    plugins: {
      tooltip: {
        callbacks: {
          label: (context) => {
            return `é‡‘é¢: Â¥${context.parsed.y.toFixed(2)}`
          }
        }
      }
    }
  }
}
```

---

## äº”ã€å®æ–½è®¡åˆ’

### 5.1 ç¬¬ä¸€é˜¶æ®µï¼ˆMVP - 2å‘¨ï¼‰

**ç›®æ ‡**ï¼šæ ¸å¿ƒåŠŸèƒ½å¯ç”¨

**ä»»åŠ¡æ¸…å•**ï¼š
- [x] æ•°æ®åº“è¡¨ç»“æ„è®¾è®¡ä¸åˆ›å»ºï¼ˆ1å¤©ï¼‰
- [x] åˆ†ç±»ç®¡ç†åç«¯APIï¼ˆ2å¤©ï¼‰
  - å¤§ç±»åˆ—è¡¨API
  - å­åˆ†ç±»CRUD API
- [x] æ‰¹é‡å½•å…¥åç«¯APIï¼ˆ2å¤©ï¼‰
  - æ‰¹é‡ä¿å­˜API
  - æŸ¥è¯¢æŸæœˆæ•°æ®API
  - å¤åˆ¶ä¸ŠæœˆAPI
- [x] åˆ†ç±»ç®¡ç†å‰ç«¯é¡µé¢ï¼ˆ3å¤©ï¼‰
  - ExpenseCategories.vue
  - CategoryDialog.vue
- [x] æ‰¹é‡å½•å…¥å‰ç«¯é¡µé¢ï¼ˆ2å¤©ï¼‰
  - ExpenseBatchUpdate.vue
- [x] åŸºç¡€è¶‹åŠ¿å›¾ï¼ˆ1å¤©ï¼‰
  - ExpenseChart.vue
- [x] è”è°ƒæµ‹è¯•ï¼ˆ1å¤©ï¼‰

### 5.2 ç¬¬äºŒé˜¶æ®µï¼ˆåŠŸèƒ½å®Œå–„ - 1å‘¨ï¼‰

**ç›®æ ‡**ï¼šä½“éªŒä¼˜åŒ–

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] è‰ç¨¿åŠŸèƒ½ï¼ˆ1å¤©ï¼‰
  - è‰ç¨¿ä¿å­˜/åŠ è½½API
  - å‰ç«¯è‡ªåŠ¨ä¿å­˜è‰ç¨¿
- [ ] è®°å½•å•æ¡æ“ä½œï¼ˆ2å¤©ï¼‰
  - æ·»åŠ /ç¼–è¾‘/åˆ é™¤API
  - RecordDialog.vue
- [ ] åˆ†ç±»å†å²æŸ¥è¯¢ä¼˜åŒ–ï¼ˆ1å¤©ï¼‰
  - åˆ†é¡µåŠ è½½
  - æ—¶é—´èŒƒå›´ç­›é€‰
- [ ] æ•°æ®éªŒè¯å¢å¼ºï¼ˆ1å¤©ï¼‰
  - å‰ç«¯è¡¨å•éªŒè¯
  - åç«¯ä¸šåŠ¡è§„åˆ™éªŒè¯
- [ ] UI/UXä¼˜åŒ–ï¼ˆ1å¤©ï¼‰
  - åŠ è½½çŠ¶æ€æç¤º
  - é”™è¯¯æç¤ºå‹å¥½åŒ–

### 5.3 ç¬¬ä¸‰é˜¶æ®µï¼ˆåˆ†æå¢å¼º - 1å‘¨ï¼‰

**ç›®æ ‡**ï¼šæ•°æ®åˆ†æèƒ½åŠ›

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] æœˆåº¦ç»Ÿè®¡APIï¼ˆ1å¤©ï¼‰
- [ ] è¶‹åŠ¿åˆ†æAPIï¼ˆ1å¤©ï¼‰
- [ ] åˆ†æå›¾è¡¨ç»„ä»¶ï¼ˆ2å¤©ï¼‰
  - é¥¼å›¾ï¼ˆæ”¯å‡ºç»“æ„ï¼‰
  - å †å æŸ±çŠ¶å›¾ï¼ˆå›ºå®švså¤§é¢ï¼‰
- [ ] æ™ºèƒ½æ´å¯Ÿï¼ˆå¯é€‰ï¼Œ1å¤©ï¼‰
  - å¼‚å¸¸æ£€æµ‹
  - å»ºè®®ç”Ÿæˆ
- [ ] æ•°æ®å¯¼å‡ºï¼ˆ1å¤©ï¼‰
  - Excelå¯¼å‡º
  - PDFæŠ¥è¡¨

### 5.4 ç¬¬å››é˜¶æ®µï¼ˆä¼˜åŒ– - æŒç»­ï¼‰

**ç›®æ ‡**ï¼šæ€§èƒ½ä¸ä½“éªŒ

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] ç§»åŠ¨ç«¯é€‚é…
- [ ] æ€§èƒ½ä¼˜åŒ–ï¼ˆç¼“å­˜ã€ç´¢å¼•ï¼‰
- [ ] å¿«æ·é”®æ”¯æŒ
- [ ] æ•°æ®å¯¼å…¥åŠŸèƒ½
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–
- [ ] æ–‡æ¡£å®Œå–„

---

## å…­ã€éªŒæ”¶æ ‡å‡†

### 6.1 åŠŸèƒ½å®Œæ•´æ€§

- [x] èƒ½æ·»åŠ /ç¼–è¾‘/åœç”¨å­åˆ†ç±»
- [x] èƒ½æ‰¹é‡å½•å…¥æŸæœˆæ‰€æœ‰åˆ†ç±»çš„æ”¯å‡º
- [x] èƒ½æŸ¥çœ‹å•ä¸ªåˆ†ç±»çš„æ”¯å‡ºè¶‹åŠ¿å›¾
- [x] èƒ½æ·»åŠ /ç¼–è¾‘/åˆ é™¤å•æ¡æ”¯å‡ºè®°å½•
- [x] è¶‹åŠ¿å›¾æ”¯æŒæ—¶é—´èŒƒå›´åˆ‡æ¢ï¼ˆ6æœˆ/1å¹´/3å¹´ï¼‰
- [x] å¤åˆ¶ä¸ŠæœˆåŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [x] è‰ç¨¿è‡ªåŠ¨ä¿å­˜ä¸åŠ è½½

### 6.2 æ•°æ®å‡†ç¡®æ€§

- [x] åŒä¸€æœŸé—´+åˆ†ç±»ä¸èƒ½é‡å¤
- [x] åŸºå‡†è´§å¸è½¬æ¢æ­£ç¡®ï¼ˆä»æ±‡ç‡è¡¨è‡ªåŠ¨æŸ¥è¯¢ï¼‰
- [x] å·®é¢è®¡ç®—æ­£ç¡®ï¼ˆæœ¬æœˆ - ä¸Šæœˆï¼‰
- [x] ç»Ÿè®¡æ±‡æ€»å‡†ç¡®ï¼ˆæ€»æ”¯å‡º = å›ºå®š + å¤§é¢ï¼‰

### 6.3 ç”¨æˆ·ä½“éªŒ

- [x] æ‰¹é‡å½•å…¥3-5åˆ†é’Ÿå†…å®Œæˆï¼ˆ100ä¸ªåˆ†ç±»ï¼‰
- [x] è¶‹åŠ¿æŸ¥çœ‹æ“ä½œæµç•…ï¼ˆ<500msæ¸²æŸ“ï¼‰
- [x] é”™è¯¯æç¤ºæ¸…æ™°å‹å¥½
- [x] ç•Œé¢é£æ ¼ä¸ç°æœ‰æ¨¡å—ä¸€è‡´
- [x] å“åº”å¼è®¾è®¡æ”¯æŒæ¡Œé¢å’Œå¹³æ¿

### 6.4 æ€§èƒ½æŒ‡æ ‡

- [x] æ‰¹é‡å½•å…¥é¡µé¢åŠ è½½æ—¶é—´ < 1ç§’
- [x] è¶‹åŠ¿å›¾æ¸²æŸ“æ—¶é—´ < 500ms
- [x] ä¿å­˜æ“ä½œå“åº”æ—¶é—´ < 2ç§’
- [x] APIå“åº”æ—¶é—´ä¸­ä½æ•° < 200ms

---

## é™„å½•

### A. å­åˆ†ç±»åˆå§‹åŒ–SQL

```sql
-- å­å¥³
INSERT INTO expense_categories_minor (major_category_id, name, is_default, sort_order)
SELECT id, 'å­¦è´¹', TRUE, 1 FROM expense_categories_major WHERE code='CHILDREN'
UNION ALL SELECT id, 'è¡¥ä¹ ç­', TRUE, 2 FROM expense_categories_major WHERE code='CHILDREN'
UNION ALL SELECT id, 'ç©å…·ä¹¦ç±', TRUE, 3 FROM expense_categories_major WHERE code='CHILDREN'
UNION ALL SELECT id, 'å…¶ä»–', TRUE, 99 FROM expense_categories_major WHERE code='CHILDREN';

-- è¡£
INSERT INTO expense_categories_minor (major_category_id, name, is_default, sort_order)
SELECT id, 'æœè£…', TRUE, 1 FROM expense_categories_major WHERE code='CLOTHING'
UNION ALL SELECT id, 'é‹å¸½', TRUE, 2 FROM expense_categories_major WHERE code='CLOTHING'
UNION ALL SELECT id, 'é…é¥°', TRUE, 3 FROM expense_categories_major WHERE code='CLOTHING';

-- é£Ÿ
INSERT INTO expense_categories_minor (major_category_id, name, is_default, sort_order)
SELECT id, 'å¤–å‡ºå°±é¤', TRUE, 1 FROM expense_categories_major WHERE code='FOOD'
UNION ALL SELECT id, 'é£Ÿæé‡‡è´­', TRUE, 2 FROM expense_categories_major WHERE code='FOOD'
UNION ALL SELECT id, 'é›¶é£Ÿé¥®æ–™', TRUE, 3 FROM expense_categories_major WHERE code='FOOD';

-- ä½
INSERT INTO expense_categories_minor (major_category_id, name, is_default, sort_order)
SELECT id, 'æˆ¿ç§Ÿ/æˆ¿è´·', TRUE, 1 FROM expense_categories_major WHERE code='HOUSING'
UNION ALL SELECT id, 'ç‰©ä¸šè´¹', TRUE, 2 FROM expense_categories_major WHERE code='HOUSING'
UNION ALL SELECT id, 'æ°´ç”µæ°”è´¹', TRUE, 3 FROM expense_categories_major WHERE code='HOUSING'
UNION ALL SELECT id, 'ç½‘ç»œç”µè¯è´¹', TRUE, 4 FROM expense_categories_major WHERE code='HOUSING'
UNION ALL SELECT id, 'ç»´ä¿®è£…ä¿®', TRUE, 5 FROM expense_categories_major WHERE code='HOUSING';

-- è¡Œ
INSERT INTO expense_categories_minor (major_category_id, name, is_default, sort_order)
SELECT id, 'å…¬å…±äº¤é€š', TRUE, 1 FROM expense_categories_major WHERE code='TRANSPORTATION'
UNION ALL SELECT id, 'æ‰“è½¦', TRUE, 2 FROM expense_categories_major WHERE code='TRANSPORTATION'
UNION ALL SELECT id, 'åŠ æ²¹', TRUE, 3 FROM expense_categories_major WHERE code='TRANSPORTATION'
UNION ALL SELECT id, 'åœè½¦è´¹', TRUE, 4 FROM expense_categories_major WHERE code='TRANSPORTATION'
UNION ALL SELECT id, 'ä¿å…»ç»´ä¿®', TRUE, 5 FROM expense_categories_major WHERE code='TRANSPORTATION';

-- ä¿é™©
INSERT INTO expense_categories_minor (major_category_id, name, is_default, sort_order)
SELECT id, 'è½¦é™©', TRUE, 1 FROM expense_categories_major WHERE code='INSURANCE'
UNION ALL SELECT id, 'åŒ»ç–—ä¿é™©', TRUE, 2 FROM expense_categories_major WHERE code='INSURANCE'
UNION ALL SELECT id, 'äººå¯¿ä¿é™©', TRUE, 3 FROM expense_categories_major WHERE code='INSURANCE';

-- äººæƒ…
INSERT INTO expense_categories_minor (major_category_id, name, is_default, sort_order)
SELECT id, 'ç¤¼é‡‘', TRUE, 1 FROM expense_categories_major WHERE code='SOCIAL'
UNION ALL SELECT id, 'é€ç¤¼', TRUE, 2 FROM expense_categories_major WHERE code='SOCIAL'
UNION ALL SELECT id, 'å­æ•¬é•¿è¾ˆ', TRUE, 3 FROM expense_categories_major WHERE code='SOCIAL';

-- å¨±ä¹
INSERT INTO expense_categories_minor (major_category_id, name, is_default, sort_order)
SELECT id, 'æ—…æ¸¸', TRUE, 1 FROM expense_categories_major WHERE code='ENTERTAINMENT'
UNION ALL SELECT id, 'ç”µå½±æ¼”å‡º', TRUE, 2 FROM expense_categories_major WHERE code='ENTERTAINMENT'
UNION ALL SELECT id, 'å¥èº«è¿åŠ¨', TRUE, 3 FROM expense_categories_major WHERE code='ENTERTAINMENT';

-- ç»è¥
INSERT INTO expense_categories_minor (major_category_id, name, is_default, sort_order)
SELECT id, 'åŠå…¬æ”¯å‡º', TRUE, 1 FROM expense_categories_major WHERE code='BUSINESS'
UNION ALL SELECT id, 'è¥é”€è´¹ç”¨', TRUE, 2 FROM expense_categories_major WHERE code='BUSINESS';

-- å…¶ä»–
INSERT INTO expense_categories_minor (major_category_id, name, is_default, sort_order)
SELECT id, 'æœªåˆ†ç±»', TRUE, 1 FROM expense_categories_major WHERE code='OTHER';
```

---

**æ–‡æ¡£ç»“æŸ**
