# 家庭理财管理系统需求说明

## 1. 项目概述

基于家庭为单位的财务管理系统，支持多成员协同管理，追踪资产负债，分析支出预算，提供智能理财建议。

## 2. 核心功能

### 2.1 家庭与用户管理

- ✅ 创建家庭，添加成员
- ✅ 家庭切换与多维度统计
- ✅ 用户资料管理
- ❌ 成员权限控制

### 2.2 收入管理

#### 分类体系
**10个大类**：工资💼 奖金🎁 投资收益📈 租金🏠 副业💡 股票RSU📊 退休基金贡献🏦 退税💰 礼金🎀 其他📦

**核心功能**：
- ✅ 预设分类（10大类+30+小类）
- ✅ 月度批量录入（YYYY-MM格式）
- ✅ 投资收益自动汇总（禁止手动录入）
- ✅ 关联资产账户（追踪收入来源）
- ✅ 多币种支持（USD/CNY/EUR/GBP/JPY/AUD/CAD）
- ✅ 年度收入预算（预算vs实际）

### 2.3 支出管理

#### 分类体系
**10个大类**：子女👶 衣👔 食🍜 住🏠 行🚗 保险🛡️ 人情🎁 娱乐🎮 医疗⚕️ 其他📦

**支出类型**：固定日常 / 大额不定期

**核心功能**：
- ✅ 自定义子分类（创建/编辑/软删除）
- ✅ 月度批量录入（3个月历史对比）
- ✅ 年度预算（预算vs实际，超支预警）
- ✅ 三级钻取分析（大类→小类→月度）
- ✅ 多币种支持（USD/CNY/EUR/GBP/JPY/AUD/CAD）

### 2.4 资产负债管理

#### 资产类别（8类）
现金、股票、退休基金、保险、房产、数字货币、贵金属、经纪账户

**税收状态**：应税 / 免税 / 延税

#### 负债类别（7类）
房贷、车贷、信用卡、个人借债、学生贷款、商业贷款、其他

**核心功能**：
- ✅ 时序数据（多时间点快照）
- ✅ 批量更新与历史查询
- ✅ 多币种与税收分类
- ✅ 按家庭汇总

### 2.5 投资管理

#### 交易记录
- ✅ 买入/卖出/分红/转入/转出
- ✅ 成本价/现价/盈亏计算
- ✅ 批量录入（月度/年度）
- ✅ 交易历史查询

#### 投资分析
- ✅ 年度大类分析（投入/市值/收益率）
- ✅ 年度账户分析（可按大类筛选）
- ✅ 账户月度趋势（每月盈亏变化）
- ✅ 多币种支持

### 2.6 数据分析与可视化

#### 趋势分析
- ✅ 净资产趋势（总资产 - 总负债）
- ✅ 单项资产趋势（盈亏计算）
- ✅ 时间范围（周/月/年/全部）
- ✅ 多货币显示

#### 资产配置分析
- ✅ 资产/负债占比饼图
- ✅ 净资产分类（资产减对应负债）
- ✅ 税收状态分析
- ✅ 资产负债率、流动性比率
- ✅ 历史数据对比

### 2.7 智能分析（部分实现）

- ⚠️ 风险评估（页面框架，核心算法待完善）
- ⚠️ 优化建议（页面框架，推荐逻辑待完善）
- ❌ 财务目标管理

### 2.8 报表导出

- ✅ **Google Sheets同步**（年度报表6工作表：封面、资产负债表、净资产、支出、投资、汇率；异步导出+实时进度+权限管理+图表可视化）
- ❌ PDF/Excel本地导出
- ❌ 数据备份与恢复

## 3. 技术架构

### 后端
- Java 17 + Spring Boot 3.2
- MySQL 8.0 + Spring Data JPA
- RESTful API
- Flyway数据库迁移

### 前端
- Vue 3 (Composition API)
- Tailwind CSS + shadcn/ui
- Chart.js (数据可视化)
- Axios (API客户端)

### 数据库核心表
```
families                      # 家庭
users                         # 用户（关联家庭）
asset_type                    # 资产类型
asset_accounts                # 资产账户（关联用户）
asset_records                 # 资产记录（时序数据）
liability_type                # 负债类型
liability_accounts            # 负债账户
liability_records             # 负债记录
investment_transactions       # 投资交易记录
income_categories_major       # 收入大类
income_categories_minor       # 收入小类
income_records                # 收入记录（月度）
income_budgets                # 年度收入预算
expense_categories_major      # 支出大类
expense_categories_minor      # 支出小类
expense_records               # 支出记录（月度）
expense_budgets               # 年度支出预算
exchange_rates                # 汇率
annual_financial_summary      # 年度汇总
google_sheets_export_jobs     # Google Sheets导出任务
```

## 4. 用户体验

- ✅ 简洁界面（Tailwind CSS + shadcn/ui）
- ⚠️ 响应式设计（部分页面已适配）
- ✅ Chart.js可视化（智能格式化 ≥1M→X.XXM, ≥1K→X.XXK）
- ❌ 暗色模式（CSS变量已配置，待启用）
- ⚠️ 数据加密（密码哈希，其他数据待加密）

## 5. 实施状态

### ✅ 已完成
- 家庭管理（多成员、切换、汇总）
- 资产负债管理（8类资产、7类负债、批量更新、历史记录）
- **收入管理**（10大类+30+小类、月度批量录入、投资收益自动汇总、关联资产账户、年度预算）
- **投资管理**（交易记录、年度分析、月度趋势）
- 支出管理（分类、批量录入、预算、三级钻取分析）
- 数据分析（趋势、配置、指标）
- 税收状态分类（应税/免税/延税）
- 多币种支持（7种货币、汇率管理）
- **Google Sheets导出**（年度财务报表6工作表+图表、异步导出、实时进度、权限管理）

### ⚠️ 部分完成
- 风险评估（页面框架已创建）
- 优化建议（页面框架已创建）
- 响应式设计（部分页面）

### ❌ 未实现
- 成员权限管理
- 目标管理
- PDF/Excel本地导出
- 暗色模式

---

**更新时间**：2026-01-05
**版本状态**：核心功能已完成，智能分析框架待完善
