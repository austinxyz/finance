# 家庭理财管理系统需求说明

## 1. 项目概述

本系统旨在帮助用户管理家庭资产负债，支持多成员家庭协同管理，追踪家庭整体财务状况，分析资产趋势，并提供智能化的理财建议。系统支持以家庭为单位统计所有成员的资产和负债，实现家庭财务的统一管理和分析。

## 2. 核心功能需求

### 2.1 家庭与用户管理

**功能要求：**
- ✅ 支持创建家庭，每个家庭有唯一的家庭名称
- ✅ 支持添加家庭成员（用户），每个用户归属于一个家庭
- ✅ 支持查看家庭成员列表
- ✅ 支持切换不同家庭进行查看和管理（TrendAnalysis页面已实现）
- ✅ 所有资产和负债都关联到具体的用户，通过用户关联到家庭
- ✅ 数据分析支持按家庭维度统计（汇总所有家庭成员的数据）
- ✅ 用户资料管理（UserProfile）
- ❌ 家庭成员权限管理（查看/编辑权限控制）

### 2.2 支出管理

#### 2.2.1 支出分类管理

**大类分类：**
- ✅ 子女（CHILDREN）👶 - 学费、补习班、玩具书籍
- ✅ 衣（CLOTHING）👔 - 服装、鞋帽、配饰
- ✅ 食（FOOD）🍜 - 饮食、外出就餐、食材采购
- ✅ 住（HOUSING）🏠 - 房租房贷、水电煤物业、生活用品
- ✅ 行（TRANSPORTATION）🚗 - 交通费、车辆维护、加油
- ✅ 保险（INSURANCE）🛡️ - 各类保险费用
- ✅ 人情（SOCIAL）🎁 - 礼金、送礼、社交活动
- ✅ 娱乐（ENTERTAINMENT）🎮 - 旅游、娱乐活动、兴趣爱好
- ✅ 经营（BUSINESS）💼 - 经营成本、商务支出
- ✅ 其他（OTHER）📦 - 未分类支出

**支出类型：**
- ✅ 固定日常（FIXED_DAILY）- 每月固定或定期发生的支出（如房租、水电费）
- ✅ 大额不定期（LARGE_IRREGULAR）- 大额且不定期的支出（如旅游、家电）

**功能要求：**
- ✅ 每个大类下可创建多个子分类
- ✅ 子分类支持自定义创建、编辑、禁用（软删除）
- ✅ 每个子分类设置支出类型（固定日常/大额不定期）
- ✅ 支出类型用于批量录入时的排序（固定日常优先显示）
- ✅ 子分类包含记录数统计，防止误删除有记录的分类
- ✅ 支持为子分类添加描述信息

#### 2.2.2 支出记录管理

**记录字段：**
- ✅ 家庭ID（必填）- 支出归属的家庭
- ✅ 用户ID（可选）- 记录人（支持家庭成员个人记录）
- ✅ 支出周期（必填）- YYYY-MM 格式的月份
- ✅ 子分类ID（必填）- 关联到具体的支出子分类
- ✅ 金额（必填）- 支出金额
- ✅ 币种（必填）- 支持 7 种货币（USD/CNY/EUR/GBP/JPY/AUD/CAD）
- ✅ 基准货币金额（自动计算）- 根据汇率自动换算为基准货币（CNY）
- ✅ 描述（可选）- 支出备注说明

**功能要求：**
- ✅ 支持单条记录的增删改查
- ✅ 支持按家庭、周期、分类查询记录
- ✅ 支持按时间范围批量查询（年度分析）
- ✅ 唯一约束：同一家庭、同一周期、同一分类、同一币种只能有一条记录
- ✅ 自动汇率转换：创建/更新时自动查询汇率并计算基准货币金额
- ✅ 多币种支持：同一家庭可以用不同币种记录不同分类的支出

#### 2.2.3 批量录入

**功能要求：**
- ✅ 月度批量输入界面，显示当月所有子分类
- ✅ 显示前 3 个月的历史金额（只读），便于参考
- ✅ 按支出类型排序（固定日常优先，大额不定期在后）
- ✅ 支持选择家庭、币种、月份
- ✅ 输入为 0 或留空时，如有历史记录则删除
- ✅ 批量保存时自动检测变化，只保存修改过的记录
- ✅ 保存成功后显示保存和删除的记录数
- ✅ 统计显示：总支出、固定支出金额及占比、大额支出金额及占比

#### 2.2.4 年度预算管理

**功能要求：**
- ✅ 年度预算设定，按子分类管理
- ✅ 支持选择家庭、年份、币种
- ✅ 为每个子分类设置年度预算金额
- ✅ 支持添加预算备注
- ✅ 批量保存预算，自动处理新增和更新
- ✅ 输入为 0 时删除该分类的预算
- ✅ 统计显示：总预算、固定支出预算及占比、大额支出预算及占比
- ✅ 唯一约束：同一家庭、同一年份、同一分类、同一币种只能有一条预算

#### 2.2.5 支出分析

**年度支出分析：**
- ✅ 三级钻取分析：大类汇总 → 小类明细 → 月度趋势
- ✅ 大类饼图：显示各大类支出占比和金额
- ✅ 小类饼图：点击大类后显示该类下的小类分布
- ✅ 月度柱状图：点击小类后显示 12 个月的支出趋势
- ✅ 支持选择家庭、年份、币种
- ✅ 同币种统计模式：选择特定币种，只汇总该币种的记录
- ✅ 交叉币种模式：选择"All"，根据汇率换算所有币种的支出
- ✅ Chart.js 可视化，智能格式化（>=1M 显示 X.XXM，>=1K 显示 X.XXK）

**预算执行分析：**
- ✅ 预算 vs 实际支出对比
- ✅ 按大类展示预算执行情况
- ✅ 图表显示预算金额、实际支出、差额
- ✅ 超支项目标红预警
- ✅ 执行率计算（实际/预算 × 100%）
- ✅ 支持选择家庭、年份、币种
- ✅ 同币种统计，避免跨币种混淆

### 2.3 资产负债表管理

#### 2.3.1 资产管理

**资产类别：**
- ✅ 现金（Cash）
  - 银行存款
  - 手头现金
  - 货币基金
- ✅ 股票（Stocks）
  - 国内股票
  - 海外股票
  - 基金
- ✅ 退休基金（Retirement Funds）
  - 401k
  - IRA
  - 养老保险
- ✅ 保险（Insurance）
  - 人寿保险现金价值
  - 年金保险
- ✅ 房产（Real Estate）
  - 自住房产
  - 投资房产
- ✅ 数字货币（Cryptocurrency）
  - 比特币
  - 以太坊
  - 其他数字货币
- ✅ 贵金属（Precious Metals）
  - 黄金
  - 白银
  - 其他贵金属
- ✅ 经纪账户（Brokerage）

**税收状态分类：**
- ✅ 应税（TAXABLE）：需要缴纳资本利得税的资产
- ✅ 免税（TAX_FREE）：免税账户中的资产
- ✅ 延税（TAX_DEFERRED）：延迟缴税的资产（如401k、IRA等）

**功能要求：**
- ✅ 每种资产类别可以包含多个账号
- ✅ 每个资产账号归属于具体的家庭成员（用户）
- ✅ 支持录入某个时间点的资产数值（时间序列记录）
- ✅ 支持手动添加、编辑、删除资产账号
- ✅ 支持为每个账号设置别名和备注
- ✅ 支持设置资产账号的税收状态
- ✅ 支持批量更新资产数据（BatchUpdate.vue）
- ✅ 数据分析时可按家庭维度汇总所有成员的资产
- ✅ 支持多币种和汇率转换（ExchangeRateManagement）
- ✅ 查看账户历史记录（AccountHistory.vue）

#### 2.3.2 负债管理

**负债类别：**
- ✅ 房贷（Mortgage）
- ✅ 车贷（Auto Loan）
- ✅ 信用卡负债（Credit Card Debt）
- ✅ 个人借债（Personal Loan）
- ✅ 学生贷款（Student Loan）
- ✅ 其他负债（Other Debt）

**功能要求：**
- ✅ 每种负债类别可以包含多个账号
- ✅ 每个负债账号归属于具体的家庭成员（用户）
- ✅ 支持录入某个时间点的负债数值（时间序列记录）
- ✅ 支持记录利率、还款期限等信息
- ✅ 支持手动添加、编辑、删除负债账号（LiabilityList.vue, LiabilityDetail.vue）
- ✅ 支持批量更新负债数据（LiabilityBatchUpdate.vue）
- ✅ 负债在税收分析中默认作为免税处理
- ✅ 数据分析时可按家庭维度汇总所有成员的负债
- ✅ 查看负债历史记录（LiabilityHistory.vue）

### 2.4 数据录入

**功能要求：**
- ✅ 支持按时间点录入资产/负债数值（时间序列记录）
- ✅ 支持批量导入历史数据（BatchUpdate, LiabilityBatchUpdate）
- ❌ 支持设置定期提醒录入数据
- ✅ 数据录入支持多种货币（自动汇率转换，ExchangeRateManagement）
- ❌ 支持拍照上传账单凭证
- ✅ 自动检测重复记录并提示
- ✅ 自动填充历史数据功能

### 2.5 数据分析与可视化

#### 2.5.1 趋势分析（TrendAnalysis.vue）

- **单项资产趋势**
  - ✅ 折线图展示某种资产的时间趋势（Chart.js）
  - ✅ 显示增长率、波动率
  - ✅ 计算盈亏金额和百分比
  - ✅ 支持按家庭维度统计所有成员的资产

- **总资产趋势**
  - ✅ 总资产随时间的变化趋势
  - ✅ 净资产（总资产-总负债）趋势
  - ✅ 资产增长速度分析
  - ✅ 支持切换家庭查看不同家庭的趋势（家庭选择器）
  - ✅ 自动汇总选定家庭所有成员的数据
  - ✅ 多时间范围选择（本周/本月/本年/全部）
  - ✅ 支持多货币显示（USD/CNY）

#### 2.5.2 资产配置分析（AssetAllocation.vue）

- **资产占比**
  - ✅ 饼图展示各类资产的占比
  - ✅ 支持按大类或细分类别查看
  - ❌ 对比理想资产配置比例
  - ✅ 支持按家庭维度统计

- **负债占比**
  - ✅ 饼图展示各类负债的占比
  - ✅ 负债率（总负债/总资产）计算
  - ❌ 高风险负债预警
  - ✅ 支持按家庭维度统计

- **净资产分析**
  - ✅ 净资产分类饼图（资产-对应负债）
  - ✅ 税收状态分析（应税/免税/延税）
  - ✅ 负债优先抵扣应税资产，再抵扣免税和延税资产
  - ✅ 支持按指定日期查看历史数据
  - ✅ 支持多货币显示（USD/CNY）
  - ✅ 支持按家庭维度统计所有成员的净资产
  - ✅ 净资产分类映射配置（支持自定义资产类别到净资产分类的映射）

#### 2.5.3 财务指标（FinancialMetrics.vue）

- ✅ 总资产（Total Assets）- 支持按家庭维度统计
- ✅ 总负债（Total Liabilities）- 支持按家庭维度统计
- ✅ 净资产（Net Worth = 总资产 - 总负债）- 支持按家庭维度统计
- ✅ 资产负债率（Debt-to-Asset Ratio）
- ✅ 流动性比率（现金及现金等价物占比）
- ❌ 投资回报率（ROI）
- ✅ 月度/年度资产变化
- ✅ 所有指标支持家庭成员汇总计算
- ✅ 多货币显示支持（USD/CNY）
- ✅ 历史数据对比功能

### 2.6 智能分析与推荐

#### 2.6.1 风险评估（RiskAssessment.vue）

- ⚠️ 资产集中度风险分析（页面已创建，功能待完善）
- ⚠️ 负债压力评估（页面已创建，功能待完善）
- ⚠️ 流动性风险预警（页面已创建，功能待完善）
- ❌ 市场风险提示（针对股票、数字货币等）
- ⚠️ 支持按家庭维度进行风险评估（框架已支持）

#### 2.6.2 优化建议（OptimizationRecommendations.vue）

- ⚠️ 资产配置优化建议（页面已创建，功能待完善）
  - ❌ 根据家庭整体情况、年龄、风险偏好给出建议
  - ❌ 多元化投资建议
- ⚠️ 负债管理建议（页面已创建，功能待完善）
  - ❌ 高息负债优先偿还提醒
  - ❌ 债务整合建议
- ❌ 储蓄目标设定与追踪（支持家庭目标）
- ❌ 退休规划建议（家庭退休规划）

#### 2.6.3 目标管理

- ❌ 设置财务目标（如：买房首付、退休金目标等）
- ❌ 支持设置家庭目标和个人目标
- ❌ 追踪目标完成进度
- ❌ 预测目标达成时间
- ❌ 提供实现目标的行动建议

> **说明：** ⚠️ 表示页面框架已创建，但核心业务逻辑未实现或功能不完整

### 2.7 报表与导出

- ❌ 月度/季度/年度财务报表（支持家庭维度）
- ❌ 资产负债表导出（PDF/Excel）- 支持导出家庭整体报表
- ❌ 数据备份与恢复
- ❌ 多维度自定义报表
- ❌ 支持按家庭或个人维度生成报表

> **说明：** 报表导出功能尚未实现，但所有数据查询API已就绪，可基于现有API实现

## 3. 技术架构

### 3.1 后端
- **框架：** Java Spring Boot
- **数据库：** MySQL
- **API：** RESTful API

### 3.2 前端
- **框架：** Vue.js 3
- **UI库：** Element Plus
- **图表：** ECharts / Chart.js

### 3.3 数据库设计要点

**核心表结构：**
- 家庭表（families）- 存储家庭信息
- 用户表（users）- 存储用户信息，关联到家庭
- 资产类别表（asset_categories）
- 资产账号表（asset_accounts）- 关联到用户
- 资产记录表（asset_records）- 时间序列数据
- 负债类别表（liability_categories）
- 负债账号表（liability_accounts）- 关联到用户
- 负债记录表（liability_records）- 时间序列数据
- **支出大类表（expense_categories_major）** - 10 个预设大类
- **支出小类表（expense_categories_minor）** - 子分类，关联到大类
- **支出记录表（expense_records）** - 月度支出记录，支持多币种
- **年度预算表（expense_budgets）** - 年度预算管理
- 汇率表（exchange_rates）- 多币种汇率管理
- 年度汇总表（annual_financial_summary）- 年度财务快照
- 财务目标表（financial_goals）- 支持家庭目标和个人目标（待实现）

## 4. 用户体验要求

- ✅ 界面简洁直观，操作流程简单（基于Tailwind CSS + shadcn/ui设计）
- ⚠️ 支持移动端响应式设计（部分页面已适配，待全面优化）
- ✅ 数据可视化清晰美观（Chart.js图表）
- ❌ 支持暗色模式（CSS变量已配置，待启用）
- ⚠️ 数据安全加密存储（密码哈希存储，其他数据待加密）

## 5. 已实现功能

### 5.1 核心功能
- ✅ 家庭管理（多成员支持）
- ✅ 按家庭维度统计资产负债
- ✅ 家庭切换功能
- ✅ 趋势分析支持家庭汇总

### 5.2 资产负债管理
- ✅ 8 类资产管理（现金/股票/退休基金/保险/房产/数字货币/贵金属/经纪账户）
- ✅ 7 类负债管理（房贷/车贷/信用卡/个人借债/学生贷款/其他）
- ✅ 批量更新功能（资产和负债）
- ✅ 历史记录查询和可视化
- ✅ 税收状态分类（应税/免税/延税）
- ✅ 多币种支持和汇率管理

### 5.3 支出管理（完整实现）
- ✅ 10 个大类 + 灵活子分类管理
- ✅ 支出类型分类（固定日常/大额不定期）
- ✅ 月度批量录入（3 个月历史对比）
- ✅ 年度预算规划
- ✅ 年度支出分析（三级钻取）
- ✅ 预算执行分析
- ✅ 多币种支持（7 种货币）
- ✅ 同币种/交叉币种统计
- ✅ 智能汇率转换

### 5.4 数据分析
- ✅ 综合趋势分析（净资产/总资产/总负债）
- ✅ 资产配置分析（饼图）
- ✅ 负债占比分析
- ✅ 财务指标计算
- ✅ 年度财务汇总（CAGR 计算）
- ✅ Chart.js 可视化（智能格式化）
- ✅ 时间轴图表（比例时间间隔）

### 5.5 技术实现
- ✅ 100% 单元测试覆盖（33/33 测试通过）
- ✅ Flyway 数据库迁移管理
- ✅ RESTful API 设计
- ✅ Vue 3 Composition API
- ✅ 响应式设计（Tailwind CSS）
- ✅ 三标签导航（管理/分析/设置）

## 6. 未来扩展功能

### 6.1 权限与安全
- 家庭成员权限管理（查看/编辑权限）
- 数据加密存储
- 双因素认证
- 操作日志审计

### 6.2 数据集成
- 自动同步银行账户数据
- 信用卡账单自动导入
- 投资账户自动同步
- 电子发票识别（OCR）

### 6.3 智能分析
- AI 智能理财顾问
- 支出异常检测
- 消费习惯分析
- 财务健康度评分
- 个性化理财建议

### 6.4 报表与导出
- 月度/季度/年度财务报表（PDF/Excel）
- 税务申报辅助报表
- 自定义报表模板
- 数据备份与恢复

### 6.5 社交与分享
- 理财知识库
- 社交分享（匿名）
- 理财社区
- 专家咨询

### 6.6 高级功能
- 税务规划工具
- 家庭财务报告自动生成
- 投资组合优化建议
- 退休规划计算器
- 教育基金规划
