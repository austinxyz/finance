# 支出管理需求文档

**版本**: v1.0
**日期**: 2024-12-10
**状态**: 待评审

---

## 一、需求概述

### 1.1 背景

现有系统能够记录资产和负债的变化，但**缺少支出流向追踪**，无法回答：
- 钱花在哪里了？（支出分类）
- 生活成本是多少？（固定 vs 大额）
- 支出趋势如何？（增长/下降）

### 1.2 目标

建立支出管理模块，实现：
- ✅ **分类记账**：按生活场景分类记录支出
- ✅ **趋势分析**：查看各类支出的变化趋势
- ✅ **快速录入**：月底集中记账，3-5分钟完成

### 1.3 设计原则

1. **月度汇总，非流水账**：记录每月每个分类的总金额，而非每笔交易
2. **固定分类**：9个大类固定（子女、衣、食、住、行、保险、人情、娱乐、经营、其他），子分类可自定义
3. **区分类型**：固定日常支出 vs 大额不规则支出
4. **降低成本**：优先易用性，不追求细粒度

---

## 二、功能需求

### 2.1 支出分类管理

#### 2.1.1 分类层级

**两级分类结构**：

```
大类（固定9个）
  ├─ 子女
  │   ├─ 学费
  │   ├─ 补习班
  │   └─ 玩具书籍
  ├─ 衣
  │   ├─ 服装
  │   └─ 鞋帽
  ├─ 食
  │   ├─ 外出就餐
  │   ├─ 食材采购
  │   └─ 零食饮料
  ├─ 住
  │   ├─ 房贷
  │   ├─ 物业费
  │   └─ 水电煤气
  ├─ 行
  │   ├─ 加油
  │   ├─ 保养维修
  │   └─ 停车费
  ├─ 保险
  │   ├─ 车险
  │   ├─ 医疗保险
  │   └─ 人寿保险
  ├─ 人情
  │   ├─ 礼金
  │   ├─ 送礼
  │   └─ 孝敬长辈
  ├─ 娱乐
  │   ├─ 旅游
  │   ├─ 电影演出
  │   └─ 健身运动
  ├─ 经营
  │   └─ 办公支出
  └─ 其他
      └─ 未分类
```

#### 2.1.2 分类管理功能

**允许的操作**：
- ✅ 添加子分类（指定所属大类 + 分类名称 + 说明）
- ✅ 编辑子分类（修改名称、说明、启用/停用状态）
- ✅ 停用子分类（保留历史数据，不可选用于新记录）
- ⚠️ 删除子分类（仅当无支出记录时允许）

**业务规则**：
1. 大类固定，不可增删改
2. 每个大类下至少保留1个启用的子分类
3. 子分类名称在同一大类下不能重复
4. 子分类名称长度：2-20个字符

---

### 2.2 支出记录管理

#### 2.2.1 记录属性

每条支出记录包含：

| 字段 | 说明 | 示例 |
|------|------|------|
| 支出期间 | YYYY-MM格式 | 2025-11 |
| 支出分类 | 二级分类 | 食 - 外出就餐 |
| 支出金额 | 正数，保留2位小数 | 1800.00 |
| 币种 | 货币代码，默认CNY | CNY |
| 支出类型 | 固定日常 / 大额支出 | 固定日常 |
| 说明 | 可选，最多200字符 | 周末聚餐 |

#### 2.2.2 支出类型定义

**固定日常支出**：
- 每月大致固定的生活开支
- 例如：房贷、物业费、学费、食材采购、加油

**大额支出**：
- 金额较大、不定期发生的支出
- 例如：旅游、家电购置、车辆维修、人情礼金

#### 2.2.3 核心功能

**功能1：批量录入**
- 选择期间（如2025-11）
- 复制上月数据（自动填充固定支出）
- 修改变化的金额，填写新增支出
- 实时计算与上月差额（绿色增加/红色减少）
- 批量保存所有变更

**功能2：分类查看**
- 按大类Tab切换（子女、衣、食...）
- 左侧列出该大类下的所有子分类
- 选中子分类后，右侧显示：
  - 趋势图：近6月/1年/3年月度支出变化
  - 记录列表：历史所有记录

**功能3：记录操作**
- 添加记录（指定期间、金额、类型、说明）
- 编辑记录（修改任意字段）
- 删除记录（需二次确认）

**业务规则**：
1. 同一期间 + 同一分类最多1条记录
2. 支出金额必须 > 0
3. 多币种支出根据系统汇率表自动转换为基准货币（CNY）
4. 删除记录不影响其他期间数据

---

### 2.3 数据分析（未来扩展）

**基础统计**（在批量录入页面底部显示）：
- 当月总支出
- 固定支出金额 + 占比
- 大额支出金额 + 占比

**趋势分析**（在分类查看页面显示）：
- 单个分类的月度支出折线图/柱状图
- 时间范围：最近6月/1年/3年/全部

**更多分析**（功能缺口分析.md中规划）：
- 月度分析报表
- 支出结构饼图
- 环比/同比增长率
- 预算执行对比

---

## 三、界面需求

### 3.1 页面导航

```
支出管理
  ├─ 分类与记录
  └─ 批量录入
```

### 3.2 页面1：分类与记录

**布局**：Tab + 左右分栏

```
┌─────────────────────────────────────────────────┐
│ 支出分类与记录                                  │
├─────────────────────────────────────────────────┤
│ [子女] [衣] [食] [住] [行] [保险] [人情] ...    │ ← Tab导航
├─────────────────────────────────────────────────┤
│                                                 │
│ ┌────────┐ ┌────────────────────────────────┐  │
│ │子分类  │ │ 选中分类：食 - 外出就餐        │  │
│ │列表    │ │ [添加记录]                     │  │
│ │        │ ├────────────────────────────────┤  │
│ │外出就餐│ │ 趋势图        │ 历史记录       │  │
│ │食材采购│ │ ┌──────────┐ │ 2025-11 ¥1800 │  │
│ │零食饮料│ │ │ [折线图] │ │ 2025-10 ¥1650 │  │
│ │        │ │ │          │ │ 2025-09 ¥2100 │  │
│ │[添加分类]│ │ └──────────┘ │ ...           │  │
│ │        │ │               │               │  │
│ └────────┘ └────────────────────────────────┘  │
│                                                 │
└─────────────────────────────────────────────────┘
```

**交互**：
1. 点击Tab切换大类（如点击"食"）
2. 左侧列表显示该大类下的子分类
3. 点击子分类（如"外出就餐"），右侧显示趋势和记录
4. 点击"添加记录"弹出对话框
5. 点击"添加分类"弹出对话框

### 3.3 页面2：批量录入

**布局**：表单列表 + 统计汇总

```
┌─────────────────────────────────────────────────┐
│ 批量录入                                        │
├─────────────────────────────────────────────────┤
│ 期间：[2025-11 ▼]  大类：[全部 ▼]  [复制上月]  │
│                                    [保存全部]   │
├─────────────────────────────────────────────────┤
│ 分类          上月    本月    类型    差额      │
│ ──────────────────────────────────────────────  │
│ 子女-学费     3500    3500    固定    --        │
│ 子女-补习班   1200    1200    固定    --        │
│ 食-外出就餐   1650    1800    固定   +150 🔺    │
│ 食-食材采购   2500    2500    固定    --        │
│ 住-房贷       8000    8000    固定    --        │
│ 娱乐-旅游     --      15000   大额   +15000 🔺  │
│ ...                                             │
├─────────────────────────────────────────────────┤
│ 统计：总支出 ¥35,000  固定 ¥25,000  大额 ¥10,000 │
└─────────────────────────────────────────────────┘
```

**交互**：
1. 选择期间（如2025-11）
2. 点击"复制上月"自动填充上月数据
3. 修改变化的金额
4. 选择支出类型（固定/大额）
5. 系统自动计算差额并高亮
6. 点击"保存全部"提交变更

### 3.4 对话框

**添加/编辑分类**：
```
┌──────────────────────┐
│ 添加子分类      [×] │
├──────────────────────┤
│ 所属大类：食         │
│ 分类名称：           │
│ ┌──────────────────┐ │
│ │ 零食饮料         │ │
│ └──────────────────┘ │
│ 说明（可选）：       │
│ ┌──────────────────┐ │
│ │ 日常零食和饮料   │ │
│ └──────────────────┘ │
│      [取消] [确定]   │
└──────────────────────┘
```

**添加/编辑记录**：
```
┌──────────────────────┐
│ 添加支出记录    [×] │
├──────────────────────┤
│ 分类：食 - 外出就餐  │
│ 期间：[2025-11 ▼]    │
│ 金额：               │
│ ┌──────────────────┐ │
│ │ ¥ 1800.00        │ │
│ └──────────────────┘ │
│ 类型：               │
│ ○ 固定日常  ○ 大额   │
│ 说明（可选）：       │
│ ┌──────────────────┐ │
│ │ 周末聚餐         │ │
│ └──────────────────┘ │
│      [取消] [保存]   │
└──────────────────────┘
```

---

## 四、用户场景

### 场景1：月底集中记账

**角色**：家庭财务管理员
**频率**：每月1次（月底）
**步骤**：
1. 进入"支出管理 → 批量录入"
2. 选择当前月份（如2025-11）
3. 点击"复制上月"自动填充
4. 浏览列表，修改有变化的金额
5. 填写本月新增的大额支出
6. 点击"保存全部"

**耗时**：3-5分钟
**价值**：快速记录当月所有支出

---

### 场景2：查看某类支出趋势

**角色**：家庭成员
**频率**：随时
**步骤**：
1. 进入"支出管理 → 分类与记录"
2. 点击Tab"食"
3. 左侧点击"外出就餐"
4. 右侧查看近12个月趋势图
5. 分析：9月支出特别高，查看记录详情

**耗时**：30秒
**价值**：快速发现异常，了解消费习惯

---

### 场景3：临时添加大额支出

**角色**：家庭成员
**频率**：不定期
**步骤**：
1. 进入"支出管理 → 分类与记录"
2. 点击Tab"娱乐"，选择"旅游"
3. 点击"添加记录"
4. 填写：期间2025-11、金额15000、类型大额、说明"国庆云南旅游"
5. 保存

**耗时**：1分钟
**价值**：及时记录不规则大额支出

---

## 五、业务规则

### 5.1 数据约束

1. **唯一性**：同一期间 + 同一分类组合唯一
2. **必填字段**：支出期间、支出分类、支出金额、支出类型
3. **金额范围**：> 0，最多2位小数
4. **期间格式**：YYYY-MM（如2025-11）
5. **分类状态**：停用的分类不可用于新记录

### 5.2 操作限制

1. **分类删除**：有支出记录的分类不可删除，只能停用
2. **分类停用**：每个大类至少保留1个启用的子分类
3. **记录删除**：需二次确认
4. **批量保存**：检测重复记录（期间+分类），提示用户确认覆盖

### 5.3 计算规则

1. **基准货币转换**：根据支出期间和币种，从系统汇率表查询对应汇率，自动转换为基准货币（CNY）
2. **差额计算**：本月金额 - 上月金额，正数显示绿色，负数显示红色
3. **统计汇总**：总支出 = ∑所有记录；固定支出 = ∑类型为"固定日常"的记录

---

## 六、非功能性需求

### 6.1 性能要求

- 批量录入页面加载时间 < 1秒（假设100条分类）
- 趋势图渲染时间 < 500ms（12个月数据）
- 保存操作响应时间 < 2秒

### 6.2 易用性要求

- 新用户无需培训，10分钟内完成首次记账
- 批量录入页面支持Tab键快速切换输入框
- 差额显示颜色高亮，一目了然
- 趋势图支持悬停显示详细数据

### 6.3 兼容性要求

- 支持主流浏览器（Chrome, Safari, Firefox）
- 响应式设计，支持桌面和平板

---

## 七、验收标准

### 7.1 功能完整性

- [x] 能添加/编辑/停用子分类
- [x] 能批量录入某月所有分类的支出
- [x] 能查看单个分类的支出趋势图
- [x] 能添加/编辑/删除单条支出记录
- [x] 趋势图支持时间范围切换（6月/1年/3年）

### 7.2 数据准确性

- [x] 同一期间+分类不能重复
- [x] 基准货币转换正确（自动从汇率表查询）
- [x] 差额计算正确
- [x] 统计汇总准确

### 7.3 用户体验

- [x] 批量录入3-5分钟内完成
- [x] 趋势查看操作流畅
- [x] 错误提示清晰友好
- [x] 界面风格与现有模块一致

---

## 八、附录

### 8.1 参考资料

- 功能缺口分析.md - 未来扩展功能规划
- 资产管理 - 账户与记录页面（界面参考）
- 资产管理 - 批量更新页面（界面参考）

### 8.2 术语表

| 术语 | 定义 |
|------|------|
| 大类 | 固定的9个一级分类：子女、衣、食、住、行、保险、人情、娱乐、经营、其他 |
| 子分类 | 大类下的二级分类，可自定义 |
| 支出期间 | YYYY-MM格式的月份，如2025-11 |
| 固定日常 | 每月大致固定的生活开支 |
| 大额支出 | 金额较大、不定期发生的支出 |
| 批量录入 | 一次性录入某月所有分类的支出 |
| 分类查看 | 查看单个分类的历史趋势和记录 |

---

**文档结束**
